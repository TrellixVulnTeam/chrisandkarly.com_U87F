!function(n){"function"==typeof define&&define.amd?define(["jquery"],n):"object"==typeof module&&module.exports?module.exports=function(t,e){return void 0===e&&(e="undefined"!=typeof window?require("jquery"):require("jquery")(t)),n(e),e}:n(jQuery)}(function(m){var n={$el:null,commentsById:{},dataFetched:!1,currentSortKey:"",options:{},events:{click:"closeDropdowns",paste:"preSavePastedAttachments","keydown [contenteditable]":"saveOnKeydown","focus [contenteditable]":"saveEditableContent","keyup [contenteditable]":"checkEditableContentForChange","paste [contenteditable]":"checkEditableContentForChange","input [contenteditable]":"checkEditableContentForChange","blur [contenteditable]":"checkEditableContentForChange","click .navigation li[data-sort-key]":"navigationElementClicked","click .navigation li.title":"toggleNavigationDropdown","click .commenting-field.main .textarea":"showMainCommentingField","click .commenting-field.main .close":"hideMainCommentingField","click .commenting-field .textarea":"increaseTextareaHeight","change .commenting-field .textarea":"increaseTextareaHeight textareaContentChanged","click .commenting-field:not(.main) .close":"removeCommentingField","click .commenting-field .send.enabled":"postComment","click .commenting-field .update.enabled":"putComment","click .commenting-field .delete.enabled":"deleteComment","click .commenting-field .attachments .attachment .delete":"preDeleteAttachment",'change .commenting-field .upload.enabled input[type="file"]':"fileInputChanged","click li.comment button.upvote":"upvoteComment","click li.comment button.delete.enabled":"deleteComment","click li.comment .hashtag":"hashtagClicked","click li.comment .ping":"pingClicked","click li.comment ul.child-comments .toggle-all":"toggleReplies","click li.comment button.reply":"replyButtonClicked","click li.comment button.edit":"editButtonClicked",dragenter:"showDroppableOverlay","dragenter .droppable-overlay":"handleDragEnter","dragleave .droppable-overlay":"handleDragLeaveForOverlay","dragenter .droppable-overlay .droppable":"handleDragEnter","dragleave .droppable-overlay .droppable":"handleDragLeaveForDroppable","dragover .droppable-overlay":"handleDragOverForOverlay","drop .droppable-overlay":"handleDrop","click .dropdown.autocomplete":"stopPropagation","mousedown .dropdown.autocomplete":"stopPropagation","touchstart .dropdown.autocomplete":"stopPropagation"},getDefaultOptions:function(){return{profilePictureURL:"",currentUserIsAdmin:!1,currentUserId:null,spinnerIconURL:"",upvoteIconURL:"",replyIconURL:"",uploadIconURL:"",attachmentIconURL:"",noCommentsIconURL:"",closeIconURL:"",textareaPlaceholderText:"Add a comment",newestText:"Newest",oldestText:"Oldest",popularText:"Popular",attachmentsText:"Attachments",sendText:"Send",replyText:"Reply",editText:"Edit",editedText:"Edited",youText:"You",saveText:"Save",deleteText:"Delete",newText:"New",viewAllRepliesText:"View all __replyCount__ replies",hideRepliesText:"Hide replies",noCommentsText:"No comments",noAttachmentsText:"No attachments",attachmentDropText:"Drop files here",textFormatter:function(t){return t},enableReplying:!0,enableEditing:!0,enableUpvoting:!0,enableDeleting:!0,enableAttachments:!1,enableHashtags:!1,enablePinging:!1,enableDeletingCommentWithReplies:!1,enableNavigation:!0,postCommentOnEnter:!1,forceResponsive:!1,readOnly:!1,defaultNavigationSortKey:"newest",highlightColor:"#2793e6",deleteButtonColor:"#C9302C",scrollContainer:this.$el,roundProfilePictures:!1,textareaRows:2,textareaRowsOnFocus:2,textareaMaxRows:5,maxRepliesVisible:2,fieldMappings:{id:"id",parent:"parent",created:"created",modified:"modified",content:"content",attachments:"attachments",pings:"pings",creator:"creator",fullname:"fullname",profilePictureURL:"profile_picture_url",isNew:"is_new",createdByAdmin:"created_by_admin",createdByCurrentUser:"created_by_current_user",upvoteCount:"upvote_count",userHasUpvoted:"user_has_upvoted"},searchUsers:function(t,e,n){e([])},getComments:function(t,e){t([])},postComment:function(t,e,n){e(t)},putComment:function(t,e,n){e(t)},deleteComment:function(t,e,n){e()},upvoteComment:function(t,e,n){e(t)},validateAttachments:function(t,e){return e(t)},hashtagClicked:function(t){},pingClicked:function(t){},refresh:function(){},timeFormatter:function(t){return new Date(t).toLocaleDateString()}}},init:function(t,e){this.$el=m(e),this.$el.addClass("jquery-comments"),this.undelegateEvents(),this.delegateEvents(),e=navigator.userAgent||navigator.vendor||window.opera,(jQuery.browser=jQuery.browser||{}).mobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)),m.browser.mobile&&this.$el.addClass("mobile"),this.options=m.extend(!0,{},this.getDefaultOptions(),t),this.options.readOnly&&this.$el.addClass("read-only"),this.currentSortKey=this.options.defaultNavigationSortKey,this.createCssDeclarations(),this.fetchDataAndRender()},delegateEvents:function(){this.bindEvents(!1)},undelegateEvents:function(){this.bindEvents(!0)},bindEvents:function(t){var e,n=t?"off":"on";for(e in this.events){var i,a,o=e.split(" ")[0],r=e.split(" ").slice(1).join(" "),s=this.events[e].split(" ");for(i in s)s.hasOwnProperty(i)&&(a=this[s[i]],a=m.proxy(a,this),""==r?this.$el[n](o,a):this.$el[n](o,r,a))}},fetchDataAndRender:function(){var n=this;this.commentsById={},this.$el.empty(),this.createHTML(),this.options.getComments(function(t){t=t.map(function(t){return n.createCommentModel(t)});n.sortComments(t,"oldest"),m(t).each(function(t,e){n.addCommentToDataModel(e)}),n.dataFetched=!0,n.render()})},fetchNext:function(){var n=this,e=this.createSpinner();this.$el.find("ul#comment-list").append(e),this.options.getComments(function(t){m(t).each(function(t,e){n.createComment(e)}),e.remove()},function(){e.remove()})},createCommentModel:function(t){var e=this.applyInternalMappings(t);return e.childs=[],e.hasAttachments=function(){return 0<e.attachments.length},e},addCommentToDataModel:function(t){t.id in this.commentsById||(this.commentsById[t.id]=t).parent&&this.getOutermostParent(t.parent).childs.push(t.id)},updateCommentModel:function(t){m.extend(this.commentsById[t.id],t)},render:function(){this.dataFetched&&(this.showActiveContainer(),this.createComments(),this.options.enableAttachments&&this.options.enableNavigation&&this.createAttachments(),this.$el.find("> .spinner").remove(),this.options.refresh())},showActiveContainer:function(){var t=this.$el.find(".navigation li[data-container-name].active").data("container-name"),t=this.$el.find('[data-container="'+t+'"]');t.siblings("[data-container]").hide(),t.show()},createComments:function(){var n=this;this.$el.find("#comment-list").remove();var i=m("<ul/>",{id:"comment-list",class:"main"}),a=[],o=[];m(this.getComments()).each(function(t,e){(null==e.parent?a:o).push(e)}),this.sortComments(a,this.currentSortKey),m(a).each(function(t,e){n.addComment(e,i)}),this.sortComments(o,"oldest"),m(o).each(function(t,e){n.addComment(e,i)}),this.$el.find('[data-container="comments"]').prepend(i)},createAttachments:function(){var n=this;this.$el.find("#attachment-list").remove();var i=m("<ul/>",{id:"attachment-list",class:"main"}),t=this.getAttachments();this.sortComments(t,"newest"),m(t).each(function(t,e){n.addAttachment(e,i)}),this.$el.find('[data-container="attachments"]').prepend(i)},addComment:function(t,e,n){e=e||this.$el.find("#comment-list");var i,a,o=this.createCommentElement(t);t.parent?(a=e.find('.comment[data-id="'+t.parent+'"]'),this.reRenderCommentActionBar(t.parent),(a=(t=(i=0==(i=a.parents(".comment").last()).length?a:i).find(".child-comments")).find(".commenting-field")).length?a.before(o):t.append(o),this.updateToggleAllButton(i)):n?e.prepend(o):e.append(o)},addAttachment:function(t,e){e=e||this.$el.find("#attachment-list");t=this.createCommentElement(t);e.prepend(t)},removeComment:function(t){var n=this,e=this.commentsById[t],i=this.getChildComments(e.id);m(i).each(function(t,e){n.removeComment(e.id)}),e.parent&&(a=(i=this.getOutermostParent(e.parent)).childs.indexOf(e.id),i.childs.splice(a,1)),delete this.commentsById[t];var a=this.$el.find('li.comment[data-id="'+t+'"]'),t=a.parents("li.comment").last();a.remove(),this.updateToggleAllButton(t)},preDeleteAttachment:function(t){var e=m(t.currentTarget).parents(".commenting-field").first();m(t.currentTarget).parents(".attachment").first().remove(),this.toggleSaveButton(e)},preSaveAttachments:function(t,e){var n,i,a,o=this;t.length&&(n=(e=e||this.$el.find(".commenting-field.main")).find(".control-row .upload"),e.hasClass("main"),i=e.find(".control-row .attachments"),t=m(t).map(function(t,e){return{mime_type:e.type,file:e}}),a=this.getAttachmentsFromCommentingField(e),t=t.filter(function(t,n){var i=!1;return m(a).each(function(t,e){n.file.name==e.file.name&&n.file.size==e.file.size&&(i=!0)}),!i}),e.hasClass("main")&&e.find(".textarea").trigger("click"),this.setButtonState(n,!1,!0),this.options.validateAttachments(t,function(t){t.length&&(m(t).each(function(t,e){e=o.createAttachmentTagElement(e,!0);i.append(e)}),o.toggleSaveButton(e)),o.setButtonState(n,!0,!1)})),n.find("input").val("")},updateToggleAllButton:function(t){var e,n,i;null!=this.options.maxRepliesVisible&&(i=(e=t.find(".child-comments")).find(".comment").not(".hidden"),n=e.find("li.toggle-all"),i.removeClass("togglable-reply"),(t=0===this.options.maxRepliesVisible?i:i.slice(0,-this.options.maxRepliesVisible)).addClass("togglable-reply"),n.find("span.text").text()==this.options.textFormatter(this.options.hideRepliesText)&&t.addClass("visible"),i.length>this.options.maxRepliesVisible?(n.length||(n=m("<li/>",{class:"toggle-all highlight-font-bold"}),t=m("<span/>",{class:"text"}),i=m("<span/>",{class:"caret"}),n.append(t).append(i),e.prepend(n)),this.setToggleAllButtonText(n,!1)):n.remove())},updateToggleAllButtons:function(){var n=this,t=this.$el.find("#comment-list");t.find(".comment").removeClass("visible"),t.children(".comment").each(function(t,e){n.updateToggleAllButton(m(e))})},sortComments:function(t,n){var a=this;"popularity"==n?t.sort(function(t,e){var n=t.childs.length,i=e.childs.length;if(a.options.enableUpvoting&&(n+=t.upvoteCount,i+=e.upvoteCount),i!=n)return i-n;t=new Date(t.created).getTime();return new Date(e.created).getTime()-t}):t.sort(function(t,e){t=new Date(t.created).getTime(),e=new Date(e.created).getTime();return"oldest"==n?t-e:e-t})},sortAndReArrangeComments:function(t){var n=this.$el.find("#comment-list"),e=this.getComments().filter(function(t){return!t.parent});this.sortComments(e,t),m(e).each(function(t,e){e=n.find("> li.comment[data-id="+e.id+"]");n.append(e)})},showActiveSort:function(){var t=this.$el.find('.navigation li[data-sort-key="'+this.currentSortKey+'"]');this.$el.find(".navigation li").removeClass("active"),t.addClass("active");var e=this.$el.find(".navigation .title");"attachments"!=this.currentSortKey?(e.addClass("active"),e.find("header").html(t.first().html())):(t=this.$el.find(".navigation ul.dropdown").children().first(),e.find("header").html(t.html())),this.showActiveContainer()},forceResponsive:function(){this.$el.addClass("responsive")},closeDropdowns:function(){this.$el.find(".dropdown").hide()},preSavePastedAttachments:function(t){var e,n,i=t.originalEvent.clipboardData.files;i&&1==i.length&&((n=m(t.target).parents(".commenting-field").first()).length&&(e=n),this.preSaveAttachments(i,e),t.preventDefault())},saveOnKeydown:function(t){var e;13==t.keyCode&&(e=t.metaKey||t.ctrlKey,(this.options.postCommentOnEnter||e)&&(m(t.currentTarget).siblings(".control-row").find(".save").trigger("click"),t.stopPropagation(),t.preventDefault()))},saveEditableContent:function(t){t=m(t.currentTarget);t.data("before",t.html())},checkEditableContentForChange:function(t){t=m(t.currentTarget);m(t[0].childNodes).each(function(){this.nodeType==Node.TEXT_NODE&&0==this.length&&this.removeNode&&this.removeNode()}),t.data("before")!=t.html()&&(t.data("before",t.html()),t.trigger("change"))},navigationElementClicked:function(t){t=m(t.currentTarget).data().sortKey;"attachments"==t?this.createAttachments():this.sortAndReArrangeComments(t),this.currentSortKey=t,this.showActiveSort()},toggleNavigationDropdown:function(t){t.stopPropagation(),m(t.currentTarget).find("~ .dropdown").toggle()},showMainCommentingField:function(t){t=m(t.currentTarget);t.siblings(".control-row").show(),t.parent().find(".close").show(),t.parent().find(".upload.inline-button").hide(),t.focus()},hideMainCommentingField:function(t){var e=m(t.currentTarget),n=this.$el.find(".commenting-field.main"),i=n.find(".textarea"),t=n.find(".control-row");this.clearTextarea(i),n.find(".attachments").empty(),this.toggleSaveButton(n),this.adjustTextareaHeight(i,!1),t.hide(),e.hide(),i.parent().find(".upload.inline-button").show(),i.blur()},increaseTextareaHeight:function(t){t=m(t.currentTarget);this.adjustTextareaHeight(t,!0)},textareaContentChanged:function(t){var e=m(t.currentTarget);e.find(".reply-to.tag").length||(e.attr("data-comment")?1<(t=e.parents("li.comment")).length&&(n=t.last().data("id"),e.attr("data-parent",n)):(n=e.parents("li.comment").last().data("id"),e.attr("data-parent",n)));var n=e.parents(".commenting-field").first();e[0].scrollHeight>e.outerHeight()?n.addClass("commenting-field-scrollable"):n.removeClass("commenting-field-scrollable"),this.toggleSaveButton(n)},toggleSaveButton:function(t){var e,n,i,a=t.find(".textarea"),o=a.siblings(".control-row").find(".save"),r=this.getTextareaContent(a,!0),s=this.getAttachmentsFromCommentingField(t),s=(commentModel=this.commentsById[a.attr("data-comment")])?(e=r!=commentModel.content,commentModel.parent&&(i=commentModel.parent.toString()),n=a.attr("data-parent")!=i,t=!1,this.options.enableAttachments&&(a=commentModel.attachments.map(function(t){return t.id}),i=s.map(function(t){return t.id}),t=!this.areArraysEqual(a,i)),e||n||t):Boolean(r.length)||Boolean(s.length);o.toggleClass("enabled",s)},removeCommentingField:function(t){t=m(t.currentTarget);t.siblings(".textarea").attr("data-comment")&&t.parents("li.comment").first().removeClass("edit"),t.parents(".commenting-field").first().remove()},postComment:function(t){var e=this,n=m(t.currentTarget),i=n.parents(".commenting-field").first();this.setButtonState(n,!1,!0);t=this.createCommentJSON(i),t=this.applyExternalMappings(t);this.options.postComment(t,function(t){e.createComment(t),i.find(".close").trigger("click"),e.setButtonState(n,!1,!1)},function(){e.setButtonState(n,!0,!1)})},createComment:function(t){var e=this.createCommentModel(t);this.addCommentToDataModel(e);var n=this.$el.find("#comment-list"),t="newest"==this.currentSortKey;this.addComment(e,n,t),"attachments"==this.currentSortKey&&e.hasAttachments()&&this.addAttachment(e)},putComment:function(t){var e=this,n=m(t.currentTarget),i=n.parents(".commenting-field").first(),a=i.find(".textarea");this.setButtonState(n,!1,!0);t=m.extend({},this.commentsById[a.attr("data-comment")]);m.extend(t,{parent:a.attr("data-parent")||null,content:this.getTextareaContent(a),pings:this.getPings(a),modified:(new Date).getTime(),attachments:this.getAttachmentsFromCommentingField(i)}),t=this.applyExternalMappings(t),this.options.putComment(t,function(t){t=e.createCommentModel(t);delete t.childs,e.updateCommentModel(t),i.find(".close").trigger("click"),e.reRenderComment(t.id),e.setButtonState(n,!1,!1)},function(){e.setButtonState(n,!0,!1)})},deleteComment:function(t){var e=this,n=m(t.currentTarget),t=n.parents(".comment").first(),t=m.extend({},this.commentsById[t.attr("data-id")]),i=t.id,a=t.parent;this.setButtonState(n,!1,!0),t=this.applyExternalMappings(t),this.options.deleteComment(t,function(){e.removeComment(i),a&&e.reRenderCommentActionBar(a),e.setButtonState(n,!1,!1)},function(){e.setButtonState(n,!0,!1)})},hashtagClicked:function(t){t=m(t.currentTarget).attr("data-value");this.options.hashtagClicked(t)},pingClicked:function(t){t=m(t.currentTarget).attr("data-value");this.options.pingClicked(t)},fileInputChanged:function(t,e){e=t.currentTarget.files;t=m(t.currentTarget).parents(".commenting-field").first();this.preSaveAttachments(e,t)},upvoteComment:function(t){var e=this,n=m(t.currentTarget).parents("li.comment").first().data().model,i=n.upvoteCount,t=n.userHasUpvoted?i-1:i+1;n.userHasUpvoted=!n.userHasUpvoted,n.upvoteCount=t,this.reRenderUpvotes(n.id);t=m.extend({},n),t=this.applyExternalMappings(t);this.options.upvoteComment(t,function(t){t=e.createCommentModel(t);e.updateCommentModel(t),e.reRenderUpvotes(t.id)},function(){n.userHasUpvoted=!n.userHasUpvoted,n.upvoteCount=i,e.reRenderUpvotes(n.id)})},toggleReplies:function(t){t=m(t.currentTarget);t.siblings(".togglable-reply").toggleClass("visible"),this.setToggleAllButtonText(t,!0)},replyButtonClicked:function(t){var e=m(t.currentTarget),n=e.parents("li.comment").last(),t=e.parents(".comment").first().data().id,e=n.find(".child-comments > .commenting-field");e.length&&e.remove(),e.find(".textarea").attr("data-parent")!=t&&(e=this.createCommentingFieldElement(t),n.find(".child-comments").append(e),n=e.find(".textarea"),this.moveCursorToEnd(n),this.ensureElementStaysVisible(e))},editButtonClicked:function(t){var e=m(t.currentTarget).parents("li.comment").first(),n=e.data().model;e.addClass("edit");t=this.createCommentingFieldElement(n.parent,n.id);e.find(".comment-wrapper").first().append(t);e=t.find(".textarea");e.attr("data-comment",n.id),e.append(this.getFormattedCommentContent(n,!0)),this.moveCursorToEnd(e),this.ensureElementStaysVisible(t)},showDroppableOverlay:function(t){this.options.enableAttachments&&(this.$el.find(".droppable-overlay").css("top",this.$el[0].scrollTop),this.$el.find(".droppable-overlay").show(),this.$el.addClass("drag-ongoing"))},handleDragEnter:function(t){var e=m(t.currentTarget).data("dnd-count")||0;e++,m(t.currentTarget).data("dnd-count",e),m(t.currentTarget).addClass("drag-over")},handleDragLeave:function(t,e){var n=m(t.currentTarget).data("dnd-count");n--,m(t.currentTarget).data("dnd-count",n),0==n&&(m(t.currentTarget).removeClass("drag-over"),e&&e())},handleDragLeaveForOverlay:function(t){var e=this;this.handleDragLeave(t,function(){e.hideDroppableOverlay()})},handleDragLeaveForDroppable:function(t){this.handleDragLeave(t)},handleDragOverForOverlay:function(t){t.stopPropagation(),t.preventDefault(),t.originalEvent.dataTransfer.dropEffect="copy"},hideDroppableOverlay:function(){this.$el.find(".droppable-overlay").hide(),this.$el.removeClass("drag-ongoing")},handleDrop:function(t){t.preventDefault(),m(t.target).trigger("dragleave"),this.hideDroppableOverlay(),this.preSaveAttachments(t.originalEvent.dataTransfer.files)},stopPropagation:function(t){t.stopPropagation()},createHTML:function(){var t=this.createMainCommentingFieldElement();this.$el.append(t),t.find(".control-row").hide(),t.find(".close").hide(),this.options.enableNavigation&&(this.$el.append(this.createNavigationElement()),this.showActiveSort());var e=this.createSpinner();this.$el.append(e);var n=m("<div/>",{class:"data-container","data-container":"comments"});this.$el.append(n);var i=m("<div/>",{class:"no-comments no-data",text:this.options.textFormatter(this.options.noCommentsText)}),a=m("<i/>",{class:"fa fa-comments fa-2x"});this.options.noCommentsIconURL.length&&(a.css("background-image",'url("'+this.options.noCommentsIconURL+'")'),a.addClass("image")),i.prepend(m("<br/>")).prepend(a),n.append(i),this.options.enableAttachments&&(t=m("<div/>",{class:"data-container","data-container":"attachments"}),this.$el.append(t),e=m("<div/>",{class:"no-attachments no-data",text:this.options.textFormatter(this.options.noAttachmentsText)}),a=m("<i/>",{class:"fa fa-paperclip fa-2x"}),this.options.attachmentIconURL.length&&(a.css("background-image",'url("'+this.options.attachmentIconURL+'")'),a.addClass("image")),e.prepend(m("<br/>")).prepend(a),t.append(e),n=m("<div/>",{class:"droppable-overlay"}),i=m("<div/>",{class:"droppable-container"}),a=m("<div/>",{class:"droppable"}),t=m("<i/>",{class:"fa fa-paperclip fa-4x"}),this.options.uploadIconURL.length&&(t.css("background-image",'url("'+this.options.uploadIconURL+'")'),t.addClass("image")),e=m("<div/>",{text:this.options.textFormatter(this.options.attachmentDropText)}),a.append(t),a.append(e),n.html(i.html(a)).hide(),this.$el.append(n))},createProfilePictureElement:function(t,e){t=t?m("<div/>").css({"background-image":"url("+t+")"}):m("<i/>",{class:"fa fa-user"});return t.addClass("profile-picture"),t.attr("data-user-id",e),this.options.roundProfilePictures&&t.addClass("round"),t},createMainCommentingFieldElement:function(){return this.createCommentingFieldElement(void 0,void 0,!0)},createCommentingFieldElement:function(t,e,n){var r=this,i=m("<div/>",{class:"commenting-field"});n&&i.addClass("main");var a=e?(g=this.commentsById[e].profilePictureURL,f=this.commentsById[e].creator,this.commentsById[e].attachments):(g=this.options.profilePictureURL,f=this.options.creator,[]),o=this.createProfilePictureElement(g,f),s=m("<div/>",{class:"textarea-wrapper"}),l=m("<div/>",{class:"control-row"}),c=m("<div/>",{class:"textarea","data-placeholder":this.options.textFormatter(this.options.textareaPlaceholderText),contenteditable:!0});this.adjustTextareaHeight(c,!1);var d=this.createCloseButton();d.addClass("inline-button");var h,p,u,g=e?"update":"send",f=e?this.options.textFormatter(this.options.saveText):this.options.textFormatter(this.options.sendText),g=m("<span/>",{class:g+" save highlight-background",text:f});return g.data("original-content",f),l.append(g),e&&this.isAllowedToDelete(e)&&(h=this.options.textFormatter(this.options.deleteText),(p=m("<span/>",{class:"delete enabled",text:h}).css("background-color",this.options.deleteButtonColor)).data("original-content",h),l.append(p)),this.options.enableAttachments&&(e=m("<span/>",{class:"enabled upload"}),h=m("<i/>",{class:"fa fa-paperclip"}),p=m("<input/>",{type:"file",multiple:"multiple","data-role":"none"}),this.options.uploadIconURL.length&&(h.css("background-image",'url("'+this.options.uploadIconURL+'")'),h.addClass("image")),e.append(h).append(p),(p=e.clone()).data("original-content",p.children()),l.append(p),n&&s.append(e.clone().addClass("inline-button")),u=m("<div/>",{class:"attachments"}),m(a).each(function(t,e){e=r.createAttachmentTagElement(e,!0);u.append(e)}),l.append(u)),s.append(d).append(c).append(l),i.append(o).append(s),t&&(c.attr("data-parent",t),(s=this.commentsById[t]).parent&&(c.html("&nbsp;"),t="@"+s.fullname,s=this.createTagElement(t,"reply-to",s.creator,{"data-user-id":s.creator}),c.prepend(s))),this.options.enablePinging&&(c.textcomplete([{match:/(^|\s)@([^@]*)$/i,index:2,search:function(t,e){t=r.normalizeSpaces(t),r.options.searchUsers(t,e,function(){e([])})},template:function(t){var e=m("<div/>"),n=r.createProfilePictureElement(t.profile_picture_url),i=m("<div/>",{class:"details"}),a=m("<div/>",{class:"name"}).html(t.fullname),o=m("<div/>",{class:"email"}).html(t.email);return t.email?i.append(a).append(o):(i.addClass("no-email"),i.append(a)),e.append(n).append(i),e.html()},replace:function(t){return" "+r.createTagElement("@"+t.fullname,"ping",t.id,{"data-user-id":t.id})[0].outerHTML+" "}}],{appendTo:".jquery-comments",dropdownClassName:"dropdown autocomplete",maxCount:5,rightEdgeOffset:0,debounce:250}),m.fn.textcomplete.Dropdown.prototype.render=function(t){var e=this._buildContents(t),n=m.map(t,function(t){return t.value});t.length?((t=t[0].strategy).id?this.$el.attr("data-strategy",t.id):this.$el.removeAttr("data-strategy"),this._renderHeader(n),this._renderFooter(n),e&&(this._renderContents(e),this._fitToBottom(),this._fitToRight(),this._activateIndexedItem()),this._setScroll()):this.noResultsMessage?this._renderNoResultsMessage(n):this.shown&&this.deactivate();e=parseInt(this.$el.css("top"))+r.options.scrollContainer.scrollTop();this.$el.css("top",e);n=this.$el.css("left");this.$el.css("left",0);e=r.$el.width()-this.$el.outerWidth(),n=Math.min(e,parseInt(n));this.$el.css("left",n)},m.fn.textcomplete.ContentEditable.prototype._skipSearch=function(t){switch(t.keyCode){case 9:case 13:case 16:case 17:case 33:case 34:case 40:case 38:case 27:return!0}if(t.ctrlKey)switch(t.keyCode){case 78:case 80:return!0}}),i},createNavigationElement:function(){var t=m("<ul/>",{class:"navigation"}),e=m("<div/>",{class:"navigation-wrapper"});t.append(e);var n=m("<li/>",{text:this.options.textFormatter(this.options.newestText),"data-sort-key":"newest","data-container-name":"comments"}),i=m("<li/>",{text:this.options.textFormatter(this.options.oldestText),"data-sort-key":"oldest","data-container-name":"comments"}),a=m("<li/>",{text:this.options.textFormatter(this.options.popularText),"data-sort-key":"popularity","data-container-name":"comments"}),o=m("<li/>",{text:this.options.textFormatter(this.options.attachmentsText),"data-sort-key":"attachments","data-container-name":"attachments"}),r=m("<i/>",{class:"fa fa-paperclip"});this.options.attachmentIconURL.length&&(r.css("background-image",'url("'+this.options.attachmentIconURL+'")'),r.addClass("image")),o.prepend(r);var s=m("<div/>",{class:"navigation-wrapper responsive"}),l=m("<ul/>",{class:"dropdown"}),c=m("<li/>",{class:"title"}),r=m("<header/>");return c.append(r),s.append(c),s.append(l),t.append(s),e.append(n).append(i),l.append(n.clone()).append(i.clone()),(this.options.enableReplying||this.options.enableUpvoting)&&(e.append(a),l.append(a.clone())),this.options.enableAttachments&&(e.append(o),s.append(o.clone())),this.options.forceResponsive&&this.forceResponsive(),t},createSpinner:function(t){var e=m("<div/>",{class:"spinner"});t&&e.addClass("inline");t=m("<i/>",{class:"fa fa-spinner fa-spin"});return this.options.spinnerIconURL.length&&(t.css("background-image",'url("'+this.options.spinnerIconURL+'")'),t.addClass("image")),e.html(t),e},createCloseButton:function(t){var e=m("<span/>",{class:t||"close"}),t=m("<i/>",{class:"fa fa-times"});return this.options.closeIconURL.length&&(t.css("background-image",'url("'+this.options.closeIconURL+'")'),t.addClass("image")),e.html(t),e},createCommentElement:function(t){var e=m("<li/>",{"data-id":t.id,class:"comment"}).data("model",t);t.createdByCurrentUser&&e.addClass("by-current-user"),t.createdByAdmin&&e.addClass("by-admin");var n=m("<ul/>",{class:"child-comments"}),i=this.createCommentWrapperElement(t);return e.append(i),null==t.parent&&e.append(n),e},createCommentWrapperElement:function(t){var r=this,e=m("<div/>",{class:"comment-wrapper"}),n=this.createProfilePictureElement(t.profilePictureURL,t.creator),i=m("<time/>",{text:this.options.timeFormatter(t.created),"data-original":t.created}),a=m("<div/>",{class:"comment-header"}),o=m("<span/>",{class:"name","data-user-id":t.creator,text:t.createdByCurrentUser?this.options.textFormatter(this.options.youText):t.fullname});a.append(o),t.createdByAdmin&&o.addClass("highlight-font-bold"),t.parent&&(s=this.commentsById[t.parent]).parent&&(c=m("<span/>",{class:"reply-to",text:s.fullname,"data-user-id":s.creator}),l=m("<i/>",{class:"fa fa-share"}),this.options.replyIconURL.length&&(l.css("background-image",'url("'+this.options.replyIconURL+'")'),l.addClass("image")),c.prepend(l),a.append(c)),t.isNew&&(p=m("<span/>",{class:"new highlight-background",text:this.options.textFormatter(this.options.newText)}),a.append(p));var s=m("<div/>",{class:"wrapper"}),l=m("<div/>",{class:"content"});l.html(this.getFormattedCommentContent(t)),t.modified&&t.modified!=t.created&&(g=this.options.timeFormatter(t.modified),f=m("<time/>",{class:"edited",text:this.options.textFormatter(this.options.editedText)+" "+g,"data-original":t.modified}),l.append(f));var c=m("<div/>",{class:"attachments"}),d=m("<div/>",{class:"previews"}),h=m("<div/>",{class:"tags"});c.append(d).append(h),this.options.enableAttachments&&t.hasAttachments()&&m(t.attachments).each(function(t,e){var n,i,a,o=void 0;!e.mime_type||2==(i=e.mime_type.split("/")).length&&(i[1],o=i[0]),"image"!=o&&"video"!=o||(n=m("<div/>"),i=m("<a/>",{class:"preview",href:e.file,target:"_blank"}),n.html(i),"image"==o?(a=m("<img/>",{src:e.file}),i.html(a)):(a=m("<video/>",{src:e.file,type:e.mime_type,controls:"controls"}),i.html(a)),d.append(n));e=r.createAttachmentTagElement(e,!1);h.append(e)});var p=m("<span/>",{class:"actions"}),u=m("<span/>",{class:"separator",text:"·"}),g=m("<button/>",{class:"action reply",type:"button",text:this.options.textFormatter(this.options.replyText)}),f=m("<i/>",{class:"fa fa-thumbs-up"});this.options.upvoteIconURL.length&&(f.css("background-image",'url("'+this.options.upvoteIconURL+'")'),f.addClass("image"));f=this.createUpvoteElement(t);return this.options.enableReplying&&p.append(g),this.options.enableUpvoting&&p.append(f),(t.createdByCurrentUser||this.options.currentUserIsAdmin)&&(t=m("<button/>",{class:"action edit",text:this.options.textFormatter(this.options.editText)}),p.append(t)),p.children().each(function(t,e){m(e).is(":last-child")||m(e).after(u.clone())}),s.append(l),s.append(c),s.append(p),e.append(n).append(i).append(a).append(s),e},createUpvoteElement:function(t){var e=m("<i/>",{class:"fa fa-thumbs-up"});return this.options.upvoteIconURL.length&&(e.css("background-image",'url("'+this.options.upvoteIconURL+'")'),e.addClass("image")),m("<button/>",{class:"action upvote"+(t.userHasUpvoted?" highlight-font":"")}).append(m("<span/>",{text:t.upvoteCount,class:"upvote-count"})).append(e)},createTagElement:function(t,e,n,i){var a=m("<input/>",{class:"tag",type:"button","data-role":"none"});return e&&a.addClass(e),a.val(t),a.attr("data-value",n),i&&a.attr(i),a},createAttachmentTagElement:function(t,e){var n=m("<a/>",{class:"tag attachment",target:"_blank"});e||n.attr("href",t.file),n.data({id:t.id,mime_type:t.mime_type,file:t.file});var i="";i=t.file instanceof File?t.file.name:(i=(i=(a=t.file.split("/"))[a.length-1]).split("?")[0],decodeURIComponent(i));var a=m("<i/>",{class:"fa fa-paperclip"});return this.options.attachmentIconURL.length&&(a.css("background-image",'url("'+this.options.attachmentIconURL+'")'),a.addClass("image")),n.append(a,i),e&&(n.addClass("deletable"),e=this.createCloseButton("delete"),n.append(e)),n},reRenderComment:function(t){var i=this.commentsById[t],t=this.$el.find('li.comment[data-id="'+i.id+'"]'),a=this;t.each(function(t,e){var n=a.createCommentWrapperElement(i);m(e).find(".comment-wrapper").first().replaceWith(n)})},reRenderCommentActionBar:function(t){var i=this.commentsById[t],t=this.$el.find('li.comment[data-id="'+i.id+'"]'),a=this;t.each(function(t,e){var n=a.createCommentWrapperElement(i);m(e).find(".actions").first().replaceWith(n.find(".actions"))})},reRenderUpvotes:function(t){var i=this.commentsById[t],t=this.$el.find('li.comment[data-id="'+i.id+'"]'),a=this;t.each(function(t,e){var n=a.createUpvoteElement(i);m(e).find(".upvote").first().replaceWith(n)})},createCssDeclarations:function(){m("head style.jquery-comments-css").remove(),this.createCss(".jquery-comments ul.navigation li.active:after {background: "+this.options.highlightColor+" !important;",NaN),this.createCss(".jquery-comments ul.navigation ul.dropdown li.active {background: "+this.options.highlightColor+" !important;",NaN),this.createCss(".jquery-comments .highlight-background {background: "+this.options.highlightColor+" !important;",NaN),this.createCss(".jquery-comments .highlight-font {color: "+this.options.highlightColor+" !important;}"),this.createCss(".jquery-comments .highlight-font-bold {color: "+this.options.highlightColor+" !important;font-weight: bold;}")},createCss:function(t){t=m("<style/>",{type:"text/css",class:"jquery-comments-css",text:t});m("head").append(t)},getComments:function(){var e=this;return Object.keys(this.commentsById).map(function(t){return e.commentsById[t]})},getChildComments:function(e){return this.getComments().filter(function(t){return t.parent==e})},getAttachments:function(){return this.getComments().filter(function(t){return t.hasAttachments()})},getOutermostParent:function(t){var e=t;do{var n=this.commentsById[e],e=n.parent}while(null!=n.parent);return n},createCommentJSON:function(t){var e=t.find(".textarea"),n=(new Date).toISOString();return{id:"c"+(this.getComments().length+1),parent:e.attr("data-parent")||null,created:n,modified:n,content:this.getTextareaContent(e),pings:this.getPings(e),fullname:this.options.textFormatter(this.options.youText),profilePictureURL:this.options.profilePictureURL,createdByCurrentUser:!0,upvoteCount:0,userHasUpvoted:!1,attachments:this.getAttachmentsFromCommentingField(t)}},isAllowedToDelete:function(n){if(this.options.enableDeleting){var i=!0;return this.options.enableDeletingCommentWithReplies||m(this.getComments()).each(function(t,e){e.parent==n&&(i=!1)}),i}return!1},setToggleAllButtonText:function(n,t){function e(){var t=i.options.textFormatter(i.options.viewAllRepliesText),e=n.siblings(".comment").not(".hidden").length,t=t.replace("__replyCount__",e);a.text(t)}var i=this,a=n.find("span.text"),o=n.find(".caret"),r=this.options.textFormatter(this.options.hideRepliesText);t?(a.text()==r?e():a.text(r),o.toggleClass("up")):a.text()!=r&&e()},setButtonState:function(t,e,n){t.toggleClass("enabled",e),n?t.html(this.createSpinner(!0)):t.html(t.data("original-content"))},adjustTextareaHeight:function(t,e){t=m(t);var n=1==e?this.options.textareaRowsOnFocus:this.options.textareaRows;do{t.css("height",2.2+1.45*(n-1)+"em"),n++;var i=t[0].scrollHeight>t.outerHeight(),a=0!=this.options.textareaMaxRows&&n>this.options.textareaMaxRows}while(i&&!a)},clearTextarea:function(t){t.empty().trigger("input")},getTextareaContent:function(t,e){t=t.clone();t.find(".reply-to.tag").remove(),t.find(".tag.hashtag").replaceWith(function(){return e?m(this).val():"#"+m(this).attr("data-value")}),t.find(".tag.ping").replaceWith(function(){return e?m(this).val():"@"+m(this).attr("data-value")});t=m("<pre/>").html(t.html());t.find("div, p, br").replaceWith(function(){return"\n"+this.innerHTML});t=t.text().replace(/^\s+/g,"");return this.normalizeSpaces(t)},getFormattedCommentContent:function(t,e){var n=this.escape(t.content),n=this.linkify(n);return n=this.highlightTags(t,n),n=e?n.replace(/(?:\n)/g,"<br>"):n},getPings:function(t){var i={};return t.find(".ping").each(function(t,e){var n=parseInt(m(e).attr("data-value")),e=m(e).val();i[n]=e.slice(1)}),i},getAttachmentsFromCommentingField:function(t){return t.find(".attachments .attachment").map(function(){return m(this).data()}).toArray()},moveCursorToEnd:function(t){var e,n;t=m(t)[0],m(t).trigger("input"),m(t).scrollTop(t.scrollHeight),void 0!==window.getSelection&&void 0!==document.createRange?((n=document.createRange()).selectNodeContents(t),n.collapse(!1),(e=window.getSelection()).removeAllRanges(),e.addRange(n)):void 0!==document.body.createTextRange&&((n=document.body.createTextRange()).moveToElementText(t),n.collapse(!1),n.select()),t.focus()},ensureElementStaysVisible:function(t){var e=t.position().top,t=t.position().top+t.outerHeight()-this.options.scrollContainer.outerHeight();this.options.scrollContainer.scrollTop()>e?this.options.scrollContainer.scrollTop(e):this.options.scrollContainer.scrollTop()<t&&this.options.scrollContainer.scrollTop(t)},escape:function(t){return m("<pre/>").text(this.normalizeSpaces(t)).html()},normalizeSpaces:function(t){return t.replace(new RegExp(" ","g")," ")},after:function(t,e){var n=this;return function(){if(0==--t)return e.apply(n,arguments)}},highlightTags:function(t,e){return this.options.enableHashtags&&(e=this.highlightHashtags(t,e)),e=this.options.enablePinging?this.highlightPings(t,e):e},highlightHashtags:function(t,e){var i=this;return e=-1!=e.indexOf("#")?e.replace(/(^|\s)#([a-z\u00C0-\u00FF\d-_]+)/gim,function(t,e,n){return e+i.createTagElement("#"+n,"hashtag",n)[0].outerHTML}):e},highlightPings:function(i,a){var o=this;return-1!=a.indexOf("@")&&m(Object.keys(i.pings)).each(function(t,e){var n="@"+i.pings[e];a=a.replace(new RegExp(n,"g"),o.createTagElement(n,"ping",e,{"data-user-id":e})[0].outerHTML)}),a},linkify:function(t){var e=/(\b(https?|ftp|file):\/\/[-A-ZÄÖÅ0-9+&@#\/%?=~_|!:,.;{}]*[-A-ZÄÖÅ0-9+&@#\/%=~_|{}])/gim,n=/(^|[^\/f])(www\.[-A-ZÄÖÅ0-9+&@#\/%?=~_|!:,.;{}]*[-A-ZÄÖÅ0-9+&@#\/%=~_|{}])/gim,i=/(([A-ZÄÖÅ0-9\-\_\.])+@[A-ZÄÖÅ\_]+?(\.[A-ZÄÖÅ]{2,6})+)/gim,a=(a=(a=t.replace(e,'<a href="$1" target="_blank">$1</a>')).replace(n,'$1<a href="https://$2" target="_blank">$2</a>')).replace(i,'<a href="mailto:$1" target="_blank">$1</a>');if(0<(t.match(/<a href/g)||[]).length){for(var o=t.split(/(<\/a>)/g),r=0;r<o.length;r++)null==o[r].match(/<a href/g)&&(o[r]=o[r].replace(e,'<a href="$1" target="_blank">$1</a>').replace(n,'$1<a href="https://$2" target="_blank">$2</a>').replace(i,'<a href="mailto:$1" target="_blank">$1</a>'));return o.join("")}return a},waitUntil:function(t,e){var n=this;t()?e():setTimeout(function(){n.waitUntil(t,e)},100)},areArraysEqual:function(t,e){if(t.length!=e.length)return!1;t.sort(),e.sort();for(var n=0;n<t.length;n++)if(t[n]!=e[n])return!1;return!0},applyInternalMappings:function(t){var e,n={},i=this.options.fieldMappings;for(e in i)i.hasOwnProperty(e)&&(n[i[e]]=e);return this.applyMappings(n,t)},applyExternalMappings:function(t){var e=this.options.fieldMappings;return this.applyMappings(e,t)},applyMappings:function(t,e){var n,i={};for(n in e)n in t&&(i[t[n]]=e[n]);return i}};m.fn.comments=function(e){return this.each(function(){var t=Object.create(n);m.data(this,"comments",t),t.init(e||{},this)})}}),jQuery.easing.jswing=jQuery.easing.swing,jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(t,e,n,i,a){return jQuery.easing[jQuery.easing.def](t,e,n,i,a)},easeInQuad:function(t,e,n,i,a){return i*(e/=a)*e+n},easeOutQuad:function(t,e,n,i,a){return-i*(e/=a)*(e-2)+n},easeInOutQuad:function(t,e,n,i,a){return(e/=a/2)<1?i/2*e*e+n:-i/2*(--e*(e-2)-1)+n},easeInCubic:function(t,e,n,i,a){return i*(e/=a)*e*e+n},easeOutCubic:function(t,e,n,i,a){return i*((e=e/a-1)*e*e+1)+n},easeInOutCubic:function(t,e,n,i,a){return(e/=a/2)<1?i/2*e*e*e+n:i/2*((e-=2)*e*e+2)+n},easeInQuart:function(t,e,n,i,a){return i*(e/=a)*e*e*e+n},easeOutQuart:function(t,e,n,i,a){return-i*((e=e/a-1)*e*e*e-1)+n},easeInOutQuart:function(t,e,n,i,a){return(e/=a/2)<1?i/2*e*e*e*e+n:-i/2*((e-=2)*e*e*e-2)+n},easeInQuint:function(t,e,n,i,a){return i*(e/=a)*e*e*e*e+n},easeOutQuint:function(t,e,n,i,a){return i*((e=e/a-1)*e*e*e*e+1)+n},easeInOutQuint:function(t,e,n,i,a){return(e/=a/2)<1?i/2*e*e*e*e*e+n:i/2*((e-=2)*e*e*e*e+2)+n},easeInSine:function(t,e,n,i,a){return-i*Math.cos(e/a*(Math.PI/2))+i+n},easeOutSine:function(t,e,n,i,a){return i*Math.sin(e/a*(Math.PI/2))+n},easeInOutSine:function(t,e,n,i,a){return-i/2*(Math.cos(Math.PI*e/a)-1)+n},easeInExpo:function(t,e,n,i,a){return 0==e?n:i*Math.pow(2,10*(e/a-1))+n},easeOutExpo:function(t,e,n,i,a){return e==a?n+i:i*(1-Math.pow(2,-10*e/a))+n},easeInOutExpo:function(t,e,n,i,a){return 0==e?n:e==a?n+i:(e/=a/2)<1?i/2*Math.pow(2,10*(e-1))+n:i/2*(2-Math.pow(2,-10*--e))+n},easeInCirc:function(t,e,n,i,a){return-i*(Math.sqrt(1-(e/=a)*e)-1)+n},easeOutCirc:function(t,e,n,i,a){return i*Math.sqrt(1-(e=e/a-1)*e)+n},easeInOutCirc:function(t,e,n,i,a){return(e/=a/2)<1?-i/2*(Math.sqrt(1-e*e)-1)+n:i/2*(Math.sqrt(1-(e-=2)*e)+1)+n},easeInElastic:function(t,e,n,i,a){var o=1.70158,r=0,s=i;return 0==e?n:1==(e/=a)?n+i:(r=r||.3*a,o=s<Math.abs(i)?(s=i,r/4):r/(2*Math.PI)*Math.asin(i/s),-(s*Math.pow(2,10*--e)*Math.sin((e*a-o)*(2*Math.PI)/r))+n)},easeOutElastic:function(t,e,n,i,a){var o=1.70158,r=0,s=i;return 0==e?n:1==(e/=a)?n+i:(r=r||.3*a,o=s<Math.abs(i)?(s=i,r/4):r/(2*Math.PI)*Math.asin(i/s),s*Math.pow(2,-10*e)*Math.sin((e*a-o)*(2*Math.PI)/r)+i+n)},easeInOutElastic:function(t,e,n,i,a){var o=1.70158,r=0,s=i;return 0==e?n:2==(e/=a/2)?n+i:(r=r||a*(.3*1.5),o=s<Math.abs(i)?(s=i,r/4):r/(2*Math.PI)*Math.asin(i/s),e<1?s*Math.pow(2,10*--e)*Math.sin((e*a-o)*(2*Math.PI)/r)*-.5+n:s*Math.pow(2,-10*--e)*Math.sin((e*a-o)*(2*Math.PI)/r)*.5+i+n)},easeInBack:function(t,e,n,i,a,o){return i*(e/=a)*e*(((o=null==o?1.70158:o)+1)*e-o)+n},easeOutBack:function(t,e,n,i,a,o){return i*((e=e/a-1)*e*(((o=null==o?1.70158:o)+1)*e+o)+1)+n},easeInOutBack:function(t,e,n,i,a,o){return null==o&&(o=1.70158),(e/=a/2)<1?i/2*(e*e*((1+(o*=1.525))*e-o))+n:i/2*((e-=2)*e*((1+(o*=1.525))*e+o)+2)+n},easeInBounce:function(t,e,n,i,a){return i-jQuery.easing.easeOutBounce(t,a-e,0,i,a)+n},easeOutBounce:function(t,e,n,i,a){return(e/=a)<1/2.75?i*(7.5625*e*e)+n:e<2/2.75?i*(7.5625*(e-=1.5/2.75)*e+.75)+n:e<2.5/2.75?i*(7.5625*(e-=2.25/2.75)*e+.9375)+n:i*(7.5625*(e-=2.625/2.75)*e+.984375)+n},easeInOutBounce:function(t,e,n,i,a){return e<a/2?.5*jQuery.easing.easeInBounce(t,2*e,0,i,a)+n:.5*jQuery.easing.easeOutBounce(t,2*e-a,0,i,a)+.5*i+n}}),function(n,i,M,h){"use strict";function p(t){return t&&t.hasOwnProperty&&t instanceof M}function H(t){return u(t)&&0<t.indexOf("%")}function _(t,e){var n=parseInt(t,10)||0;return e&&H(t)&&(n=B.getViewport()[e]/100*n),Math.ceil(n)}function L(t,e){return _(t,e)+"px"}var a=M("html"),o=M(n),c=M(i),B=M.fancybox=function(){B.open.apply(this,arguments)},r=navigator.userAgent.match(/msie/i),s=null,d=i.createTouch!==h,u=function(t){return t&&"string"===M.type(t)};M.extend(B,{version:"2.1.5",defaults:{padding:15,margin:20,width:800,height:600,minWidth:100,minHeight:100,maxWidth:9999,maxHeight:9999,pixelRatio:1,autoSize:!0,autoHeight:!1,autoWidth:!1,autoResize:!0,autoCenter:!d,fitToView:!0,aspectRatio:!1,topRatio:.5,leftRatio:.5,scrolling:"auto",wrapCSS:"",arrows:!0,closeBtn:!0,closeClick:!1,nextClick:!1,mouseWheel:!0,autoPlay:!1,playSpeed:3e3,preload:3,modal:!1,loop:!0,ajax:{dataType:"html",headers:{"X-fancyBox":!0}},iframe:{scrolling:"auto",preload:!0},swf:{wmode:"transparent",allowfullscreen:"true",allowscriptaccess:"always"},keys:{next:{13:"left",34:"up",39:"left",40:"up"},prev:{8:"right",33:"down",37:"right",38:"down"},close:[27],play:[32],toggle:[70]},direction:{next:"left",prev:"right"},scrollOutside:!0,index:0,type:null,href:null,content:null,title:null,tpl:{wrap:'<div class="fancybox-wrap" tabIndex="-1"><div class="fancybox-skin"><div class="fancybox-outer"><div class="fancybox-inner"></div></div></div></div>',image:'<img class="fancybox-image" src="{href}" alt="" />',iframe:'<iframe id="fancybox-frame{rnd}" name="fancybox-frame{rnd}" class="fancybox-iframe" frameborder="0" vspace="0" hspace="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen'+(r?' allowtransparency="true"':"")+"></iframe>",error:'<p class="fancybox-error">The requested content cannot be loaded.<br/>Please try again later.</p>',closeBtn:'<a title="Close" class="fancybox-item fancybox-close" href="javascript:;"></a>',next:'<a title="Next" class="fancybox-nav fancybox-next" href="javascript:;"><span></span></a>',prev:'<a title="Previous" class="fancybox-nav fancybox-prev" href="javascript:;"><span></span></a>'},openEffect:"fade",openSpeed:250,openEasing:"swing",openOpacity:!0,openMethod:"zoomIn",closeEffect:"fade",closeSpeed:250,closeEasing:"swing",closeOpacity:!0,closeMethod:"zoomOut",nextEffect:"elastic",nextSpeed:250,nextEasing:"swing",nextMethod:"changeIn",prevEffect:"elastic",prevSpeed:250,prevEasing:"swing",prevMethod:"changeOut",helpers:{overlay:!0,title:!0},onCancel:M.noop,beforeLoad:M.noop,afterLoad:M.noop,beforeShow:M.noop,afterShow:M.noop,beforeChange:M.noop,beforeClose:M.noop,afterClose:M.noop},group:{},opts:{},previous:null,coming:null,current:null,isActive:!1,isOpen:!1,isOpened:!1,wrap:null,skin:null,outer:null,inner:null,player:{timer:null,isActive:!1},ajaxLoad:null,imgPreload:null,transitions:{},helpers:{},open:function(c,d){if(c&&(M.isPlainObject(d)||(d={}),!1!==B.close(!0)))return M.isArray(c)||(c=p(c)?M(c).get():[c]),M.each(c,function(t,e){var n,i,a,o,r,s,l={};"object"===M.type(e)&&(e.nodeType&&(e=M(e)),p(e)?(l={href:e.data("fancybox-href")||e.attr("href"),title:e.data("fancybox-title")||e.attr("title"),isDom:!0,element:e},M.metadata&&M.extend(!0,l,e.metadata())):l=e),n=d.href||l.href||(u(e)?e:null),i=d.title!==h?d.title:l.title||"",!(o=(a=d.content||l.content)?"html":d.type||l.type)&&l.isDom&&(o=(o=e.data("fancybox-type"))||((r=e.prop("class").match(/fancybox\.(\w+)/))?r[1]:null)),u(n)&&(o||(B.isImage(n)?o="image":B.isSWF(n)?o="swf":"#"===n.charAt(0)?o="inline":u(e)&&(o="html",a=e)),"ajax"===o&&(n=(s=n.split(/\s+/,2)).shift(),s=s.shift())),a||("inline"===o?n?a=M(u(n)?n.replace(/.*(?=#[^\s]+$)/,""):n):l.isDom&&(a=e):"html"===o?a=n:o||n||!l.isDom||(o="inline",a=e)),M.extend(l,{href:n,type:o,content:a,title:i,selector:s}),c[t]=l}),B.opts=M.extend(!0,{},B.defaults,d),d.keys!==h&&(B.opts.keys=!!d.keys&&M.extend({},B.defaults.keys,d.keys)),B.group=c,B._start(B.opts.index)},cancel:function(){var t=B.coming;t&&!1!==B.trigger("onCancel")&&(B.hideLoading(),B.ajaxLoad&&B.ajaxLoad.abort(),B.ajaxLoad=null,B.imgPreload&&(B.imgPreload.onload=B.imgPreload.onerror=null),t.wrap&&t.wrap.stop(!0,!0).trigger("onReset").remove(),B.coming=null,B.current||B._afterZoomOut(t))},close:function(t){B.cancel(),!1!==B.trigger("beforeClose")&&(B.unbindEvents(),B.isActive&&(B.isOpen&&!0!==t?(B.isOpen=B.isOpened=!1,B.isClosing=!0,M(".fancybox-item, .fancybox-nav").remove(),B.wrap.stop(!0,!0).removeClass("fancybox-opened"),B.transitions[B.current.closeMethod]()):(M(".fancybox-wrap").stop(!0).trigger("onReset").remove(),B._afterZoomOut())))},play:function(t){function e(){i(),B.current&&B.player.isActive&&(B.player.timer=setTimeout(B.next,B.current.playSpeed))}function n(){i(),c.unbind(".player"),B.player.isActive=!1,B.trigger("onPlayEnd")}var i=function(){clearTimeout(B.player.timer)};!0===t||!B.player.isActive&&!1!==t?B.current&&(B.current.loop||B.current.index<B.group.length-1)&&(B.player.isActive=!0,c.bind({"onCancel.player beforeClose.player":n,"onUpdate.player":e,"beforeLoad.player":i}),e(),B.trigger("onPlayStart")):n()},next:function(t){var e=B.current;e&&(u(t)||(t=e.direction.next),B.jumpto(e.index+1,t,"next"))},prev:function(t){var e=B.current;e&&(u(t)||(t=e.direction.prev),B.jumpto(e.index-1,t,"prev"))},jumpto:function(t,e,n){var i=B.current;i&&(t=_(t),B.direction=e||i.direction[t>=i.index?"next":"prev"],B.router=n||"jumpto",i.loop&&(t<0&&(t=i.group.length+t%i.group.length),t%=i.group.length),i.group[t]!==h&&(B.cancel(),B._start(t)))},reposition:function(t,e){var n=B.current,i=n?n.wrap:null;i&&(e=B._getPosition(e),t&&"scroll"===t.type?(delete e.position,i.stop(!0,!0).animate(e,200)):(i.css(e),n.pos=M.extend({},n.dim,e)))},update:function(e){var n=e&&e.type,i=!n||"orientationchange"===n;i&&(clearTimeout(s),s=null),B.isOpen&&!s&&(s=setTimeout(function(){var t=B.current;t&&!B.isClosing&&(B.wrap.removeClass("fancybox-tmp"),(i||"load"===n||"resize"===n&&t.autoResize)&&B._setDimension(),"scroll"===n&&t.canShrink||B.reposition(e),B.trigger("onUpdate"),s=null)},i&&!d?0:300))},toggle:function(t){B.isOpen&&(B.current.fitToView="boolean"===M.type(t)?t:!B.current.fitToView,d&&(B.wrap.removeAttr("style").addClass("fancybox-tmp"),B.trigger("onUpdate")),B.update())},hideLoading:function(){c.unbind(".loading"),M("#fancybox-loading").remove()},showLoading:function(){var t,e;B.hideLoading(),t=M('<div id="fancybox-loading"><div></div></div>').click(B.cancel).appendTo("body"),c.bind("keydown.loading",function(t){27===(t.which||t.keyCode)&&(t.preventDefault(),B.cancel())}),B.defaults.fixed||(e=B.getViewport(),t.css({position:"absolute",top:.5*e.h+e.y,left:.5*e.w+e.x}))},getViewport:function(){var t=B.current&&B.current.locked||!1,e={x:o.scrollLeft(),y:o.scrollTop()};return t?(e.w=t[0].clientWidth,e.h=t[0].clientHeight):(e.w=d&&n.innerWidth?n.innerWidth:o.width(),e.h=d&&n.innerHeight?n.innerHeight:o.height()),e},unbindEvents:function(){B.wrap&&p(B.wrap)&&B.wrap.unbind(".fb"),c.unbind(".fb"),o.unbind(".fb")},bindEvents:function(){var e,l=B.current;l&&(o.bind("orientationchange.fb"+(d?"":" resize.fb")+(l.autoCenter&&!l.locked?" scroll.fb":""),B.update),(e=l.keys)&&c.bind("keydown.fb",function(n){var i=n.which||n.keyCode,t=n.target||n.srcElement;if(27===i&&B.coming)return!1;n.ctrlKey||n.altKey||n.shiftKey||n.metaKey||t&&(t.type||M(t).is("[contenteditable]"))||M.each(e,function(t,e){return 1<l.group.length&&e[i]!==h?(B[t](e[i]),n.preventDefault(),!1):-1<M.inArray(i,e)?(B[t](),n.preventDefault(),!1):void 0})}),M.fn.mousewheel&&l.mouseWheel&&B.wrap.bind("mousewheel.fb",function(t,e,n,i){for(var a,o=t.target||null,r=M(o),s=!1;r.length&&!(s||r.is(".fancybox-skin")||r.is(".fancybox-wrap"));)s=(a=r[0])&&!(a.style.overflow&&"hidden"===a.style.overflow)&&(a.clientWidth&&a.scrollWidth>a.clientWidth||a.clientHeight&&a.scrollHeight>a.clientHeight),r=M(r).parent();0===e||s||1<B.group.length&&!l.canShrink&&(0<i||0<n?B.prev(0<i?"down":"left"):(i<0||n<0)&&B.next(i<0?"up":"right"),t.preventDefault())}))},trigger:function(n,t){var e,i=t||B.coming||B.current;if(i){if(!1===(e=M.isFunction(i[n])?i[n].apply(i,Array.prototype.slice.call(arguments,1)):e))return!1;i.helpers&&M.each(i.helpers,function(t,e){e&&B.helpers[t]&&M.isFunction(B.helpers[t][n])&&B.helpers[t][n](M.extend(!0,{},B.helpers[t].defaults,e),i)}),c.trigger(n)}},isImage:function(t){return u(t)&&t.match(/(^data:image\/.*,)|(\.(jp(e|g|eg)|gif|png|bmp|webp|svg)((\?|#).*)?$)/i)},isSWF:function(t){return u(t)&&t.match(/\.(swf)((\?|#).*)?$/i)},_start:function(t){var e,n,i={};if(t=_(t),!(n=B.group[t]||null))return!1;if(e=(i=M.extend(!0,{},B.opts,n)).margin,n=i.padding,"number"===M.type(e)&&(i.margin=[e,e,e,e]),"number"===M.type(n)&&(i.padding=[n,n,n,n]),i.modal&&M.extend(!0,i,{closeBtn:!1,closeClick:!1,nextClick:!1,arrows:!1,mouseWheel:!1,keys:null,helpers:{overlay:{closeClick:!1}}}),i.autoSize&&(i.autoWidth=i.autoHeight=!0),"auto"===i.width&&(i.autoWidth=!0),"auto"===i.height&&(i.autoHeight=!0),i.group=B.group,i.index=t,B.coming=i,!1!==B.trigger("beforeLoad")){if(e=i.type,n=i.href,!e)return B.coming=null,!(!B.current||!B.router||"jumpto"===B.router)&&(B.current.index=t,B[B.router](B.direction));if(B.isActive=!0,"image"!==e&&"swf"!==e||(i.autoHeight=i.autoWidth=!1,i.scrolling="visible"),"image"===e&&(i.aspectRatio=!0),"iframe"===e&&d&&(i.scrolling="scroll"),i.wrap=M(i.tpl.wrap).addClass("fancybox-"+(d?"mobile":"desktop")+" fancybox-type-"+e+" fancybox-tmp "+i.wrapCSS).appendTo(i.parent||"body"),M.extend(i,{skin:M(".fancybox-skin",i.wrap),outer:M(".fancybox-outer",i.wrap),inner:M(".fancybox-inner",i.wrap)}),M.each(["Top","Right","Bottom","Left"],function(t,e){i.skin.css("padding"+e,L(i.padding[t]))}),B.trigger("onReady"),"inline"===e||"html"===e){if(!i.content||!i.content.length)return B._error("content")}else if(!n)return B._error("href");"image"===e?B._loadImage():"ajax"===e?B._loadAjax():"iframe"===e?B._loadIframe():B._afterLoad()}else B.coming=null},_error:function(t){M.extend(B.coming,{type:"html",autoWidth:!0,autoHeight:!0,minWidth:0,minHeight:0,scrolling:"no",hasError:t,content:B.coming.tpl.error}),B._afterLoad()},_loadImage:function(){var t=B.imgPreload=new Image;t.onload=function(){this.onload=this.onerror=null,B.coming.width=this.width/B.opts.pixelRatio,B.coming.height=this.height/B.opts.pixelRatio,B._afterLoad()},t.onerror=function(){this.onload=this.onerror=null,B._error("image")},t.src=B.coming.href,!0!==t.complete&&B.showLoading()},_loadAjax:function(){var n=B.coming;B.showLoading(),B.ajaxLoad=M.ajax(M.extend({},n.ajax,{url:n.href,error:function(t,e){B.coming&&"abort"!==e?B._error("ajax",t):B.hideLoading()},success:function(t,e){"success"===e&&(n.content=t,B._afterLoad())}}))},_loadIframe:function(){var t=B.coming,e=M(t.tpl.iframe.replace(/\{rnd\}/g,(new Date).getTime())).attr("scrolling",d?"auto":t.iframe.scrolling).attr("src",t.href);M(t.wrap).bind("onReset",function(){try{M(this).find("iframe").hide().attr("src","//about:blank").end().empty()}catch(t){}}),t.iframe.preload&&(B.showLoading(),e.one("load",function(){M(this).data("ready",1),d||M(this).bind("load.fb",B.update),M(this).parents(".fancybox-wrap").width("100%").removeClass("fancybox-tmp").show(),B._afterLoad()})),t.content=e.appendTo(t.inner),t.iframe.preload||B._afterLoad()},_preloadImages:function(){for(var t,e=B.group,n=B.current,i=e.length,a=n.preload?Math.min(n.preload,i-1):0,o=1;o<=a;o+=1)"image"===(t=e[(n.index+o)%i]).type&&t.href&&((new Image).src=t.href)},_afterLoad:function(){var t,n,e,i,a,o=B.coming,r=B.current,s="fancybox-placeholder";if(B.hideLoading(),o&&!1!==B.isActive){if(!1===B.trigger("afterLoad",o,r))return o.wrap.stop(!0).trigger("onReset").remove(),void(B.coming=null);switch(r&&(B.trigger("beforeChange",r),r.wrap.stop(!0).removeClass("fancybox-opened").find(".fancybox-item, .fancybox-nav").remove()),B.unbindEvents(),n=(t=o).content,e=o.type,o=o.scrolling,M.extend(B,{wrap:t.wrap,skin:t.skin,outer:t.outer,inner:t.inner,current:t,previous:r}),i=t.href,e){case"inline":case"ajax":case"html":t.selector?n=M("<div>").html(n).find(t.selector):p(n)&&(n.data(s)||n.data(s,M('<div class="'+s+'"></div>').insertAfter(n).hide()),n=n.show().detach(),t.wrap.bind("onReset",function(){M(this).find(n).length&&n.hide().replaceAll(n.data(s)).data(s,!1)}));break;case"image":n=t.tpl.image.replace("{href}",i);break;case"swf":n='<object id="fancybox-swf" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"><param name="movie" value="'+i+'"></param>',a="",M.each(t.swf,function(t,e){n+='<param name="'+t+'" value="'+e+'"></param>',a+=" "+t+'="'+e+'"'}),n+='<embed src="'+i+'" type="application/x-shockwave-flash" width="100%" height="100%"'+a+"></embed></object>"}p(n)&&n.parent().is(t.inner)||t.inner.append(n),B.trigger("beforeShow"),t.inner.css("overflow","yes"===o?"scroll":"no"===o?"hidden":o),B._setDimension(),B.reposition(),B.isOpen=!1,B.coming=null,B.bindEvents(),B.isOpened?r.prevMethod&&B.transitions[r.prevMethod]():M(".fancybox-wrap").not(t.wrap).stop(!0).trigger("onReset").remove(),B.transitions[B.isOpened?t.nextMethod:t.openMethod](),B._preloadImages()}},_setDimension:function(){var t,e,n,i,a,o,r,s,l,c,d,h,p,u,g,f=B.getViewport(),m=0,v=B.wrap,y=B.skin,b=B.inner,x=B.current,w=x.width,C=x.height,k=x.minWidth,R=x.minHeight,T=x.maxWidth,S=x.maxHeight,j=x.scrolling,E=x.scrollOutside?x.scrollbarWidth:0,A=x.margin,I=_(A[1]+A[3]),O=_(A[0]+A[2]);if(v.add(y).add(b).width("auto").height("auto").removeClass("fancybox-tmp"),a=I+(n=_(y.outerWidth(!0)-y.width())),o=O+(i=_(y.outerHeight(!0)-y.height())),r=H(w)?(f.w-a)*_(w)/100:w,s=H(C)?(f.h-o)*_(C)/100:C,"iframe"===x.type){if(u=x.content,x.autoHeight&&1===u.data("ready"))try{u[0].contentWindow.document.location&&(b.width(r).height(9999),g=u.contents().find("body"),E&&g.css("overflow-x","hidden"),s=g.outerHeight(!0))}catch(t){}}else(x.autoWidth||x.autoHeight)&&(b.addClass("fancybox-tmp"),x.autoWidth||b.width(r),x.autoHeight||b.height(s),x.autoWidth&&(r=b.width()),x.autoHeight&&(s=b.height()),b.removeClass("fancybox-tmp"));if(w=_(r),C=_(s),l=r/s,k=_(H(k)?_(k,"w")-a:k),T=_(H(T)?_(T,"w")-a:T),R=_(H(R)?_(R,"h")-o:R),A=T,g=S=_(H(S)?_(S,"h")-o:S),x.fitToView&&(T=Math.min(f.w-a,T),S=Math.min(f.h-o,S)),h=f.w-I,p=f.h-O,x.aspectRatio?(C=(w=S<(C=T<w?_((w=T)/l):C)?_((C=S)*l):w)<k?_((w=k)/l):C)<R&&(w=_((C=R)*l)):(w=Math.max(k,Math.min(w,T)),x.autoHeight&&"iframe"!==x.type&&(b.width(w),C=b.height()),C=Math.max(R,Math.min(C,S))),x.fitToView)if(b.width(w).height(C),v.width(w+n),c=v.width(),d=v.height(),x.aspectRatio)for(;(h<c||p<d)&&k<w&&R<C&&!(19<m++);)C=Math.max(R,Math.min(S,C-10)),(w=_(C*l))<k&&(C=_((w=k)/l)),T<w&&(C=_((w=T)/l)),b.width(w).height(C),v.width(w+n),c=v.width(),d=v.height();else w=Math.max(k,Math.min(w,w-(c-h))),C=Math.max(R,Math.min(C,C-(d-p)));E&&"auto"===j&&C<s&&w+n+E<h&&(w+=E),b.width(w).height(C),v.width(w+n),c=v.width(),d=v.height(),t=(h<c||p<d)&&k<w&&R<C,e=x.aspectRatio?w<A&&C<g&&w<r&&C<s:(w<A||C<g)&&(w<r||C<s),M.extend(x,{dim:{width:L(c),height:L(d)},origWidth:r,origHeight:s,canShrink:t,canExpand:e,wPadding:n,hPadding:i,wrapSpace:d-y.outerHeight(!0),skinSpace:y.height()-C}),!u&&x.autoHeight&&R<C&&C<S&&!e&&b.height("auto")},_getPosition:function(t){var e=B.current,n=B.getViewport(),i=e.margin,a=B.wrap.width()+i[1]+i[3],o=B.wrap.height()+i[0]+i[2],i={position:"absolute",top:i[0],left:i[3]};return e.autoCenter&&e.fixed&&!t&&o<=n.h&&a<=n.w?i.position="fixed":e.locked||(i.top+=n.y,i.left+=n.x),i.top=L(Math.max(i.top,i.top+(n.h-o)*e.topRatio)),i.left=L(Math.max(i.left,i.left+(n.w-a)*e.leftRatio)),i},_afterZoomIn:function(){var e=B.current;e&&(B.isOpen=B.isOpened=!0,B.wrap.css("overflow","visible").addClass("fancybox-opened"),B.update(),(e.closeClick||e.nextClick&&1<B.group.length)&&B.inner.css("cursor","pointer").bind("click.fb",function(t){M(t.target).is("a")||M(t.target).parent().is("a")||(t.preventDefault(),B[e.closeClick?"close":"next"]())}),e.closeBtn&&M(e.tpl.closeBtn).appendTo(B.skin).bind("click.fb",function(t){t.preventDefault(),B.close()}),e.arrows&&1<B.group.length&&((e.loop||0<e.index)&&M(e.tpl.prev).appendTo(B.outer).bind("click.fb",B.prev),(e.loop||e.index<B.group.length-1)&&M(e.tpl.next).appendTo(B.outer).bind("click.fb",B.next)),B.trigger("afterShow"),e.loop||e.index!==e.group.length-1?B.opts.autoPlay&&!B.player.isActive&&(B.opts.autoPlay=!1,B.play()):B.play(!1))},_afterZoomOut:function(t){t=t||B.current,M(".fancybox-wrap").trigger("onReset").remove(),M.extend(B,{group:{},opts:{},router:!1,current:null,isActive:!1,isOpened:!1,isOpen:!1,isClosing:!1,wrap:null,skin:null,outer:null,inner:null}),B.trigger("afterClose",t)}}),B.transitions={getOrigPosition:function(){var t=B.current,e=t.element,n=t.orig,i={},a=50,o=50,r=t.hPadding,s=t.wPadding,l=B.getViewport();return!n&&t.isDom&&e.is(":visible")&&((n=e.find("img:first")).length||(n=e)),p(n)?(i=n.offset(),n.is("img")&&(a=n.outerWidth(),o=n.outerHeight())):(i.top=l.y+(l.h-o)*t.topRatio,i.left=l.x+(l.w-a)*t.leftRatio),"fixed"!==B.wrap.css("position")&&!t.locked||(i.top-=l.y,i.left-=l.x),i={top:L(i.top-r*t.topRatio),left:L(i.left-s*t.leftRatio),width:L(a+s),height:L(o+r)}},step:function(t,e){var n=e.prop,i=B.current,a=i.wrapSpace,o=i.skinSpace;"width"!==n&&"height"!==n||(e=e.end===e.start?1:(t-e.start)/(e.end-e.start),B.isClosing&&(e=1-e),i=t-("width"===n?i.wPadding:i.hPadding),B.skin[n](_("width"===n?i:i-a*e)),B.inner[n](_("width"===n?i:i-a*e-o*e)))},zoomIn:function(){var t=B.current,e=t.pos,n=t.openEffect,i="elastic"===n,a=M.extend({opacity:1},e);delete a.position,i?(e=this.getOrigPosition(),t.openOpacity&&(e.opacity=.1)):"fade"===n&&(e.opacity=.1),B.wrap.css(e).animate(a,{duration:"none"===n?0:t.openSpeed,easing:t.openEasing,step:i?this.step:null,complete:B._afterZoomIn})},zoomOut:function(){var t=B.current,e=t.closeEffect,n="elastic"===e,i={opacity:.1};n&&(i=this.getOrigPosition(),t.closeOpacity&&(i.opacity=.1)),B.wrap.animate(i,{duration:"none"===e?0:t.closeSpeed,easing:t.closeEasing,step:n?this.step:null,complete:B._afterZoomOut})},changeIn:function(){var t,e=B.current,n=e.nextEffect,i=e.pos,a={opacity:1},o=B.direction;i.opacity=.1,"elastic"===n&&(t="down"===o||"up"===o?"top":"left","down"===o||"right"===o?(i[t]=L(_(i[t])-200),a[t]="+=200px"):(i[t]=L(_(i[t])+200),a[t]="-=200px")),"none"===n?B._afterZoomIn():B.wrap.css(i).animate(a,{duration:e.nextSpeed,easing:e.nextEasing,complete:B._afterZoomIn})},changeOut:function(){var t=B.previous,e=t.prevEffect,n={opacity:.1},i=B.direction;"elastic"===e&&(n["down"===i||"up"===i?"top":"left"]=("up"===i||"left"===i?"-":"+")+"=200px"),t.wrap.animate(n,{duration:"none"===e?0:t.prevSpeed,easing:t.prevEasing,complete:function(){M(this).trigger("onReset").remove()}})}},B.helpers.overlay={defaults:{closeClick:!0,speedOut:200,showEarly:!0,css:{},locked:!d,fixed:!0},overlay:null,fixed:!1,el:M("html"),create:function(t){t=M.extend({},this.defaults,t),this.overlay&&this.close(),this.overlay=M('<div class="fancybox-overlay"></div>').appendTo((B.coming||t).parent),this.fixed=!1,t.fixed&&B.defaults.fixed&&(this.overlay.addClass("fancybox-overlay-fixed"),this.fixed=!0)},open:function(t){var e=this;t=M.extend({},this.defaults,t),this.overlay?this.overlay.unbind(".overlay").width("auto").height("auto"):this.create(t),this.fixed||(o.bind("resize.overlay",M.proxy(this.update,this)),this.update()),t.closeClick&&this.overlay.bind("click.overlay",function(t){if(M(t.target).hasClass("fancybox-overlay"))return(B.isActive?B:e).close(),!1}),this.overlay.css(t.css).show()},close:function(){var t,e;o.unbind("resize.overlay"),this.el.hasClass("fancybox-lock")&&(M(".fancybox-margin").removeClass("fancybox-margin"),t=o.scrollTop(),e=o.scrollLeft(),this.el.removeClass("fancybox-lock"),o.scrollTop(t).scrollLeft(e)),M(".fancybox-overlay").remove().hide(),M.extend(this,{overlay:null,fixed:!1})},update:function(){var t,e="100%";this.overlay.width(e).height("100%"),r?(t=Math.max(i.documentElement.offsetWidth,i.body.offsetWidth),c.width()>t&&(e=c.width())):c.width()>o.width()&&(e=c.width()),this.overlay.width(e).height(c.height())},onReady:function(t,e){var n=this.overlay;M(".fancybox-overlay").stop(!0,!0),n||this.create(t),t.locked&&this.fixed&&e.fixed&&(n||(this.margin=c.height()>o.height()&&M("html").css("margin-right").replace("px","")),e.locked=this.overlay.append(e.wrap),e.fixed=!1),!0===t.showEarly&&this.beforeShow.apply(this,arguments)},beforeShow:function(t,e){var n;e.locked&&(!1!==this.margin&&(M("*").filter(function(){return"fixed"===M(this).css("position")&&!M(this).hasClass("fancybox-overlay")&&!M(this).hasClass("fancybox-wrap")}).addClass("fancybox-margin"),this.el.addClass("fancybox-margin")),n=o.scrollTop(),e=o.scrollLeft(),this.el.addClass("fancybox-lock"),o.scrollTop(n).scrollLeft(e)),this.open(t)},onUpdate:function(){this.fixed||this.update()},afterClose:function(t){this.overlay&&!B.coming&&this.overlay.fadeOut(t.speedOut,M.proxy(this.close,this))}},B.helpers.title={defaults:{type:"float",position:"bottom"},beforeShow:function(t){var e,n,i=B.current,a=i.title,o=t.type;if(M.isFunction(a)&&(a=a.call(i.element,i)),u(a)&&""!==M.trim(a)){switch(e=M('<div class="fancybox-title fancybox-title-'+o+'-wrap">'+a+"</div>"),o){case"inside":n=B.skin;break;case"outside":n=B.wrap;break;case"over":n=B.inner;break;default:n=B.skin,e.appendTo("body"),r&&e.width(e.width()),e.wrapInner('<span class="child"></span>'),B.current.margin[2]+=Math.abs(_(e.css("margin-bottom")))}e["top"===t.position?"prependTo":"appendTo"](n)}}},M.fn.fancybox=function(o){function t(t){var e,n,i=M(this).blur(),a=l;t.ctrlKey||t.altKey||t.shiftKey||t.metaKey||i.is(".fancybox-wrap")||(e=o.groupAttr||"data-fancybox-group",(n=i.attr(e))||(e="rel",n=i.get(0)[e]),n&&""!==n&&"nofollow"!==n&&(a=(i=(i=s.length?M(s):r).filter("["+e+'="'+n+'"]')).index(this)),o.index=a,!1!==B.open(i,o)&&t.preventDefault())}var r=M(this),s=this.selector||"",l=(o=o||{}).index||0;return s&&!1!==o.live?c.undelegate(s,"click.fb-start").delegate(s+":not('.fancybox-item, .fancybox-nav')","click.fb-start",t):r.unbind("click.fb-start").bind("click.fb-start",t),this.filter("[data-fancybox-start=1]").trigger("click"),this},c.ready(function(){var t,e;M.scrollbarWidth===h&&(M.scrollbarWidth=function(){var t=M('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body"),e=t.children(),e=e.innerWidth()-e.height(99).innerWidth();return t.remove(),e}),M.support.fixedPosition===h&&(M.support.fixedPosition=(t=M('<div style="position:fixed;top:20px;"></div>').appendTo("body"),e=20===t[0].offsetTop||15===t[0].offsetTop,t.remove(),e)),M.extend(B.defaults,{scrollbarWidth:M.scrollbarWidth(),fixed:M.support.fixedPosition,parent:M("body")}),t=M(n).width(),a.addClass("fancybox-lock-test"),e=M(n).width(),a.removeClass("fancybox-lock-test"),M("<style type='text/css'>.fancybox-margin{margin-right:"+(e-t)+"px;}</style>").appendTo("head")})}(window,document,jQuery),function(i,n,S,d){function h(t){return t&&t.hasOwnProperty&&t instanceof S}function j(t){return p(t)&&0<t.indexOf("%")}function E(t,e){var n=parseInt(t,10)||0;return e&&j(t)&&(n*=I.getViewport()[e]/100),Math.ceil(n)}function A(t,e){return E(t,e)+"px"}var a=S("html"),o=S(i),c=S(n),I=S.fancybox=function(){I.open.apply(this,arguments)},r=navigator.userAgent.match(/msie/i),s=null,l=n.createTouch!==d,p=function(t){return t&&"string"===S.type(t)};S.extend(I,{version:"2.1.5",defaults:{padding:15,margin:20,width:800,height:600,minWidth:100,minHeight:100,maxWidth:9999,maxHeight:9999,pixelRatio:1,autoSize:!0,autoHeight:!1,autoWidth:!1,autoResize:!0,autoCenter:!l,fitToView:!0,aspectRatio:!1,topRatio:.5,leftRatio:.5,scrolling:"auto",wrapCSS:"",arrows:!0,closeBtn:!0,closeClick:!1,nextClick:!1,mouseWheel:!0,autoPlay:!1,playSpeed:3e3,preload:3,modal:!1,loop:!0,ajax:{dataType:"html",headers:{"X-fancyBox":!0}},iframe:{scrolling:"auto",preload:!0},swf:{wmode:"transparent",allowfullscreen:"true",allowscriptaccess:"always"},keys:{next:{13:"left",34:"up",39:"left",40:"up"},prev:{8:"right",33:"down",37:"right",38:"down"},close:[27],play:[32],toggle:[70]},direction:{next:"left",prev:"right"},scrollOutside:!0,index:0,type:null,href:null,content:null,title:null,tpl:{wrap:'<div class="fancybox-wrap" tabIndex="-1"><div class="fancybox-skin"><div class="fancybox-outer"><div class="fancybox-inner"></div></div></div></div>',image:'<img class="fancybox-image" src="{href}" alt="" />',iframe:'<iframe id="fancybox-frame{rnd}" name="fancybox-frame{rnd}" class="fancybox-iframe" frameborder="0" vspace="0" hspace="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen'+(r?' allowtransparency="true"':"")+"></iframe>",error:'<p class="fancybox-error">The requested content cannot be loaded.<br/>Please try again later.</p>',closeBtn:'<a title="Close" class="fancybox-item fancybox-close" href="javascript:;"></a>',next:'<a title="Next" class="fancybox-nav fancybox-next" href="javascript:;"><span></span></a>',prev:'<a title="Previous" class="fancybox-nav fancybox-prev" href="javascript:;"><span></span></a>'},openEffect:"fade",openSpeed:250,openEasing:"swing",openOpacity:!0,openMethod:"zoomIn",closeEffect:"fade",closeSpeed:250,closeEasing:"swing",closeOpacity:!0,closeMethod:"zoomOut",nextEffect:"elastic",nextSpeed:250,nextEasing:"swing",nextMethod:"changeIn",prevEffect:"elastic",prevSpeed:250,prevEasing:"swing",prevMethod:"changeOut",helpers:{overlay:!0,title:!0},onCancel:S.noop,beforeLoad:S.noop,afterLoad:S.noop,beforeShow:S.noop,afterShow:S.noop,beforeChange:S.noop,beforeClose:S.noop,afterClose:S.noop},group:{},opts:{},previous:null,coming:null,current:null,isActive:!1,isOpen:!1,isOpened:!1,wrap:null,skin:null,outer:null,inner:null,player:{timer:null,isActive:!1},ajaxLoad:null,imgPreload:null,transitions:{},helpers:{},open:function(l,c){if(l&&(S.isPlainObject(c)||(c={}),!1!==I.close(!0)))return S.isArray(l)||(l=h(l)?S(l).get():[l]),S.each(l,function(t,e){var n,i,a,o,r,s={};"object"===S.type(e)&&(e.nodeType&&(e=S(e)),h(e)?(s={href:e.data("fancybox-href")||e.attr("href"),title:e.data("fancybox-title")||e.attr("title"),isDom:!0,element:e},S.metadata&&S.extend(!0,s,e.metadata())):s=e),n=c.href||s.href||(p(e)?e:null),i=c.title!==d?c.title:s.title||"",!(o=(a=c.content||s.content)?"html":c.type||s.type)&&s.isDom&&(o=(o=e.data("fancybox-type"))||((o=e.prop("class").match(/fancybox\.(\w+)/))?o[1]:null)),p(n)&&(o||(I.isImage(n)?o="image":I.isSWF(n)?o="swf":"#"===n.charAt(0)?o="inline":p(e)&&(o="html",a=e)),"ajax"===o&&(n=(r=n.split(/\s+/,2)).shift(),r=r.shift())),a||("inline"===o?n?a=S(p(n)?n.replace(/.*(?=#[^\s]+$)/,""):n):s.isDom&&(a=e):"html"===o?a=n:o||n||!s.isDom||(o="inline",a=e)),S.extend(s,{href:n,type:o,content:a,title:i,selector:r}),l[t]=s}),I.opts=S.extend(!0,{},I.defaults,c),c.keys!==d&&(I.opts.keys=!!c.keys&&S.extend({},I.defaults.keys,c.keys)),I.group=l,I._start(I.opts.index)},cancel:function(){var t=I.coming;t&&!1!==I.trigger("onCancel")&&(I.hideLoading(),I.ajaxLoad&&I.ajaxLoad.abort(),I.ajaxLoad=null,I.imgPreload&&(I.imgPreload.onload=I.imgPreload.onerror=null),t.wrap&&t.wrap.stop(!0,!0).trigger("onReset").remove(),I.coming=null,I.current||I._afterZoomOut(t))},close:function(t){I.cancel(),!1!==I.trigger("beforeClose")&&(I.unbindEvents(),I.isActive&&(I.isOpen&&!0!==t?(I.isOpen=I.isOpened=!1,I.isClosing=!0,S(".fancybox-item, .fancybox-nav").remove(),I.wrap.stop(!0,!0).removeClass("fancybox-opened"),I.transitions[I.current.closeMethod]()):(S(".fancybox-wrap").stop(!0).trigger("onReset").remove(),I._afterZoomOut())))},play:function(t){function e(){clearTimeout(I.player.timer)}function n(){e(),I.current&&I.player.isActive&&(I.player.timer=setTimeout(I.next,I.current.playSpeed))}function i(){e(),c.unbind(".player"),I.player.isActive=!1,I.trigger("onPlayEnd")}!0===t||!I.player.isActive&&!1!==t?I.current&&(I.current.loop||I.current.index<I.group.length-1)&&(I.player.isActive=!0,c.bind({"onCancel.player beforeClose.player":i,"onUpdate.player":n,"beforeLoad.player":e}),n(),I.trigger("onPlayStart")):i()},next:function(t){var e=I.current;e&&(p(t)||(t=e.direction.next),I.jumpto(e.index+1,t,"next"))},prev:function(t){var e=I.current;e&&(p(t)||(t=e.direction.prev),I.jumpto(e.index-1,t,"prev"))},jumpto:function(t,e,n){var i=I.current;i&&(t=E(t),I.direction=e||i.direction[t>=i.index?"next":"prev"],I.router=n||"jumpto",i.loop&&(t<0&&(t=i.group.length+t%i.group.length),t%=i.group.length),i.group[t]!==d&&(I.cancel(),I._start(t)))},reposition:function(t,e){var n=I.current,i=n?n.wrap:null;i&&(e=I._getPosition(e),t&&"scroll"===t.type?(delete e.position,i.stop(!0,!0).animate(e,200)):(i.css(e),n.pos=S.extend({},n.dim,e)))},update:function(e){var n=e&&e.type,i=!n||"orientationchange"===n;i&&(clearTimeout(s),s=null),I.isOpen&&!s&&(s=setTimeout(function(){var t=I.current;t&&!I.isClosing&&(I.wrap.removeClass("fancybox-tmp"),(i||"load"===n||"resize"===n&&t.autoResize)&&I._setDimension(),"scroll"===n&&t.canShrink||I.reposition(e),I.trigger("onUpdate"),s=null)},i&&!l?0:300))},toggle:function(t){I.isOpen&&(I.current.fitToView="boolean"===S.type(t)?t:!I.current.fitToView,l&&(I.wrap.removeAttr("style").addClass("fancybox-tmp"),I.trigger("onUpdate")),I.update())},hideLoading:function(){c.unbind(".loading"),S("#fancybox-loading").remove()},showLoading:function(){var t,e;I.hideLoading(),t=S('<div id="fancybox-loading"><div></div></div>').click(I.cancel).appendTo("body"),c.bind("keydown.loading",function(t){27===(t.which||t.keyCode)&&(t.preventDefault(),I.cancel())}),I.defaults.fixed||(e=I.getViewport(),t.css({position:"absolute",top:.5*e.h+e.y,left:.5*e.w+e.x}))},getViewport:function(){var t=I.current&&I.current.locked||!1,e={x:o.scrollLeft(),y:o.scrollTop()};return t?(e.w=t[0].clientWidth,e.h=t[0].clientHeight):(e.w=l&&i.innerWidth?i.innerWidth:o.width(),e.h=l&&i.innerHeight?i.innerHeight:o.height()),e},unbindEvents:function(){I.wrap&&h(I.wrap)&&I.wrap.unbind(".fb"),c.unbind(".fb"),o.unbind(".fb")},bindEvents:function(){var e,r=I.current;r&&(o.bind("orientationchange.fb"+(l?"":" resize.fb")+(r.autoCenter&&!r.locked?" scroll.fb":""),I.update),(e=r.keys)&&c.bind("keydown.fb",function(n){var i=n.which||n.keyCode,t=n.target||n.srcElement;if(27===i&&I.coming)return!1;n.ctrlKey||n.altKey||n.shiftKey||n.metaKey||t&&(t.type||S(t).is("[contenteditable]"))||S.each(e,function(t,e){return 1<r.group.length&&e[i]!==d?(I[t](e[i]),n.preventDefault(),!1):-1<S.inArray(i,e)?(I[t](),n.preventDefault(),!1):void 0})}),S.fn.mousewheel&&r.mouseWheel&&I.wrap.bind("mousewheel.fb",function(t,e,n,i){for(var a=S(t.target||null),o=!1;a.length&&!o&&!a.is(".fancybox-skin")&&!a.is(".fancybox-wrap");)o=a[0]&&!(a[0].style.overflow&&"hidden"===a[0].style.overflow)&&(a[0].clientWidth&&a[0].scrollWidth>a[0].clientWidth||a[0].clientHeight&&a[0].scrollHeight>a[0].clientHeight),a=S(a).parent();0!==e&&!o&&1<I.group.length&&!r.canShrink&&(0<i||0<n?I.prev(0<i?"down":"left"):(i<0||n<0)&&I.next(i<0?"up":"right"),t.preventDefault())}))},trigger:function(n,t){var e,i=t||I.coming||I.current;if(i){if(!1===(e=S.isFunction(i[n])?i[n].apply(i,Array.prototype.slice.call(arguments,1)):e))return!1;i.helpers&&S.each(i.helpers,function(t,e){e&&I.helpers[t]&&S.isFunction(I.helpers[t][n])&&I.helpers[t][n](S.extend(!0,{},I.helpers[t].defaults,e),i)}),c.trigger(n)}},isImage:function(t){return p(t)&&t.match(/(^data:image\/.*,)|(\.(jp(e|g|eg)|gif|png|bmp|webp|svg)((\?|#).*)?$)/i)},isSWF:function(t){return p(t)&&t.match(/\.(swf)((\?|#).*)?$/i)},_start:function(t){var e,n,i={};if(t=E(t),!(e=I.group[t]||null))return!1;if(e=(i=S.extend(!0,{},I.opts,e)).margin,n=i.padding,"number"===S.type(e)&&(i.margin=[e,e,e,e]),"number"===S.type(n)&&(i.padding=[n,n,n,n]),i.modal&&S.extend(!0,i,{closeBtn:!1,closeClick:!1,nextClick:!1,arrows:!1,mouseWheel:!1,keys:null,helpers:{overlay:{closeClick:!1}}}),i.autoSize&&(i.autoWidth=i.autoHeight=!0),"auto"===i.width&&(i.autoWidth=!0),"auto"===i.height&&(i.autoHeight=!0),i.group=I.group,i.index=t,I.coming=i,!1===I.trigger("beforeLoad"))I.coming=null;else{if(n=i.type,e=i.href,!n)return I.coming=null,!(!I.current||!I.router||"jumpto"===I.router)&&(I.current.index=t,I[I.router](I.direction));if(I.isActive=!0,"image"!==n&&"swf"!==n||(i.autoHeight=i.autoWidth=!1,i.scrolling="visible"),"image"===n&&(i.aspectRatio=!0),"iframe"===n&&l&&(i.scrolling="scroll"),i.wrap=S(i.tpl.wrap).addClass("fancybox-"+(l?"mobile":"desktop")+" fancybox-type-"+n+" fancybox-tmp "+i.wrapCSS).appendTo(i.parent||"body"),S.extend(i,{skin:S(".fancybox-skin",i.wrap),outer:S(".fancybox-outer",i.wrap),inner:S(".fancybox-inner",i.wrap)}),S.each(["Top","Right","Bottom","Left"],function(t,e){i.skin.css("padding"+e,A(i.padding[t]))}),I.trigger("onReady"),"inline"===n||"html"===n){if(!i.content||!i.content.length)return I._error("content")}else if(!e)return I._error("href");"image"===n?I._loadImage():"ajax"===n?I._loadAjax():"iframe"===n?I._loadIframe():I._afterLoad()}},_error:function(t){S.extend(I.coming,{type:"html",autoWidth:!0,autoHeight:!0,minWidth:0,minHeight:0,scrolling:"no",hasError:t,content:I.coming.tpl.error}),I._afterLoad()},_loadImage:function(){var t=I.imgPreload=new Image;t.onload=function(){this.onload=this.onerror=null,I.coming.width=this.width/I.opts.pixelRatio,I.coming.height=this.height/I.opts.pixelRatio,I._afterLoad()},t.onerror=function(){this.onload=this.onerror=null,I._error("image")},t.src=I.coming.href,!0!==t.complete&&I.showLoading()},_loadAjax:function(){var n=I.coming;I.showLoading(),I.ajaxLoad=S.ajax(S.extend({},n.ajax,{url:n.href,error:function(t,e){I.coming&&"abort"!==e?I._error("ajax",t):I.hideLoading()},success:function(t,e){"success"===e&&(n.content=t,I._afterLoad())}}))},_loadIframe:function(){var t=I.coming,e=S(t.tpl.iframe.replace(/\{rnd\}/g,(new Date).getTime())).attr("scrolling",l?"auto":t.iframe.scrolling).attr("src",t.href);S(t.wrap).bind("onReset",function(){try{S(this).find("iframe").hide().attr("src","//about:blank").end().empty()}catch(t){}}),t.iframe.preload&&(I.showLoading(),e.one("load",function(){S(this).data("ready",1),l||S(this).bind("load.fb",I.update),S(this).parents(".fancybox-wrap").width("100%").removeClass("fancybox-tmp").show(),I._afterLoad()})),t.content=e.appendTo(t.inner),t.iframe.preload||I._afterLoad()},_preloadImages:function(){for(var t,e=I.group,n=I.current,i=e.length,a=n.preload?Math.min(n.preload,i-1):0,o=1;o<=a;o+=1)"image"===(t=e[(n.index+o)%i]).type&&t.href&&((new Image).src=t.href)},_afterLoad:function(){var n,t,e,i,a,o=I.coming,r=I.current;if(I.hideLoading(),o&&!1!==I.isActive)if(!1===I.trigger("afterLoad",o,r))o.wrap.stop(!0).trigger("onReset").remove(),I.coming=null;else{switch(r&&(I.trigger("beforeChange",r),r.wrap.stop(!0).removeClass("fancybox-opened").find(".fancybox-item, .fancybox-nav").remove()),I.unbindEvents(),n=o.content,t=o.type,e=o.scrolling,S.extend(I,{wrap:o.wrap,skin:o.skin,outer:o.outer,inner:o.inner,current:o,previous:r}),i=o.href,t){case"inline":case"ajax":case"html":o.selector?n=S("<div>").html(n).find(o.selector):h(n)&&(n.data("fancybox-placeholder")||n.data("fancybox-placeholder",S('<div class="fancybox-placeholder"></div>').insertAfter(n).hide()),n=n.show().detach(),o.wrap.bind("onReset",function(){S(this).find(n).length&&n.hide().replaceAll(n.data("fancybox-placeholder")).data("fancybox-placeholder",!1)}));break;case"image":n=o.tpl.image.replace("{href}",i);break;case"swf":n='<object id="fancybox-swf" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"><param name="movie" value="'+i+'"></param>',a="",S.each(o.swf,function(t,e){n+='<param name="'+t+'" value="'+e+'"></param>',a+=" "+t+'="'+e+'"'}),n+='<embed src="'+i+'" type="application/x-shockwave-flash" width="100%" height="100%"'+a+"></embed></object>"}h(n)&&n.parent().is(o.inner)||o.inner.append(n),I.trigger("beforeShow"),o.inner.css("overflow","yes"===e?"scroll":"no"===e?"hidden":e),I._setDimension(),I.reposition(),I.isOpen=!1,I.coming=null,I.bindEvents(),I.isOpened?r.prevMethod&&I.transitions[r.prevMethod]():S(".fancybox-wrap").not(o.wrap).stop(!0).trigger("onReset").remove(),I.transitions[I.isOpened?o.nextMethod:o.openMethod](),I._preloadImages()}},_setDimension:function(){var t,e,n,i,a,o,r,s,l,c=I.getViewport(),d=0,h=!1,p=!1,h=I.wrap,u=I.skin,g=I.inner,f=I.current,p=f.width,m=f.height,v=f.minWidth,y=f.minHeight,b=f.maxWidth,x=f.maxHeight,w=f.scrolling,C=f.scrollOutside?f.scrollbarWidth:0,k=f.margin,R=E(k[1]+k[3]),T=E(k[0]+k[2]);if(h.add(u).add(g).width("auto").height("auto").removeClass("fancybox-tmp"),e=R+(k=E(u.outerWidth(!0)-u.width())),n=T+(t=E(u.outerHeight(!0)-u.height())),i=j(p)?(c.w-e)*E(p)/100:p,a=j(m)?(c.h-n)*E(m)/100:m,"iframe"===f.type){if(l=f.content,f.autoHeight&&1===l.data("ready"))try{l[0].contentWindow.document.location&&(g.width(i).height(9999),o=l.contents().find("body"),C&&o.css("overflow-x","hidden"),a=o.outerHeight(!0))}catch(t){}}else(f.autoWidth||f.autoHeight)&&(g.addClass("fancybox-tmp"),f.autoWidth||g.width(i),f.autoHeight||g.height(a),f.autoWidth&&(i=g.width()),f.autoHeight&&(a=g.height()),g.removeClass("fancybox-tmp"));if(p=E(i),m=E(a),s=i/a,v=E(j(v)?E(v,"w")-e:v),b=E(j(b)?E(b,"w")-e:b),y=E(j(y)?E(y,"h")-n:y),o=b,r=x=E(j(x)?E(x,"h")-n:x),f.fitToView&&(b=Math.min(c.w-e,b),x=Math.min(c.h-n,x)),e=c.w-R,T=c.h-T,f.aspectRatio?(m=(p=x<(m=b<p?E((p=b)/s):m)?E((m=x)*s):p)<v?E((p=v)/s):m)<y&&(p=E((m=y)*s)):(p=Math.max(v,Math.min(p,b)),f.autoHeight&&"iframe"!==f.type&&(g.width(p),m=g.height()),m=Math.max(y,Math.min(m,x))),f.fitToView)if(g.width(p).height(m),h.width(p+k),c=h.width(),R=h.height(),f.aspectRatio)for(;(e<c||T<R)&&v<p&&y<m&&!(19<d++);)m=Math.max(y,Math.min(x,m-10)),(p=E(m*s))<v&&(m=E((p=v)/s)),b<p&&(m=E((p=b)/s)),g.width(p).height(m),h.width(p+k),c=h.width(),R=h.height();else p=Math.max(v,Math.min(p,p-(c-e))),m=Math.max(y,Math.min(m,m-(R-T)));C&&"auto"===w&&m<a&&p+k+C<e&&(p+=C),g.width(p).height(m),h.width(p+k),c=h.width(),R=h.height(),h=(e<c||T<R)&&v<p&&y<m,p=f.aspectRatio?p<o&&m<r&&p<i&&m<a:(p<o||m<r)&&(p<i||m<a),S.extend(f,{dim:{width:A(c),height:A(R)},origWidth:i,origHeight:a,canShrink:h,canExpand:p,wPadding:k,hPadding:t,wrapSpace:R-u.outerHeight(!0),skinSpace:u.height()-m}),!l&&f.autoHeight&&y<m&&m<x&&!p&&g.height("auto")},_getPosition:function(t){var e=I.current,n=I.getViewport(),i=e.margin,a=I.wrap.width()+i[1]+i[3],o=I.wrap.height()+i[0]+i[2],i={position:"absolute",top:i[0],left:i[3]};return e.autoCenter&&e.fixed&&!t&&o<=n.h&&a<=n.w?i.position="fixed":e.locked||(i.top+=n.y,i.left+=n.x),i.top=A(Math.max(i.top,i.top+(n.h-o)*e.topRatio)),i.left=A(Math.max(i.left,i.left+(n.w-a)*e.leftRatio)),i},_afterZoomIn:function(){var e=I.current;e&&(I.isOpen=I.isOpened=!0,I.wrap.css("overflow","visible").addClass("fancybox-opened"),I.update(),(e.closeClick||e.nextClick&&1<I.group.length)&&I.inner.css("cursor","pointer").bind("click.fb",function(t){S(t.target).is("a")||S(t.target).parent().is("a")||(t.preventDefault(),I[e.closeClick?"close":"next"]())}),e.closeBtn&&S(e.tpl.closeBtn).appendTo(I.skin).bind("click.fb",function(t){t.preventDefault(),I.close()}),e.arrows&&1<I.group.length&&((e.loop||0<e.index)&&S(e.tpl.prev).appendTo(I.outer).bind("click.fb",I.prev),(e.loop||e.index<I.group.length-1)&&S(e.tpl.next).appendTo(I.outer).bind("click.fb",I.next)),I.trigger("afterShow"),e.loop||e.index!==e.group.length-1?I.opts.autoPlay&&!I.player.isActive&&(I.opts.autoPlay=!1,I.play()):I.play(!1))},_afterZoomOut:function(t){t=t||I.current,S(".fancybox-wrap").trigger("onReset").remove(),S.extend(I,{group:{},opts:{},router:!1,current:null,isActive:!1,isOpened:!1,isOpen:!1,isClosing:!1,wrap:null,skin:null,outer:null,inner:null}),I.trigger("afterClose",t)}}),I.transitions={getOrigPosition:function(){var t=I.current,e=t.element,n=t.orig,i={},a=50,o=50,r=t.hPadding,s=t.wPadding,l=I.getViewport();return!n&&t.isDom&&e.is(":visible")&&((n=e.find("img:first")).length||(n=e)),h(n)?(i=n.offset(),n.is("img")&&(a=n.outerWidth(),o=n.outerHeight())):(i.top=l.y+(l.h-o)*t.topRatio,i.left=l.x+(l.w-a)*t.leftRatio),"fixed"!==I.wrap.css("position")&&!t.locked||(i.top-=l.y,i.left-=l.x),{top:A(i.top-r*t.topRatio),left:A(i.left-s*t.leftRatio),width:A(a+s),height:A(o+r)}},step:function(t,e){var n=e.prop,i=I.current,a=i.wrapSpace,o=i.skinSpace;"width"!==n&&"height"!==n||(e=e.end===e.start?1:(t-e.start)/(e.end-e.start),I.isClosing&&(e=1-e),i=t-(i="width"===n?i.wPadding:i.hPadding),I.skin[n](E("width"===n?i:i-a*e)),I.inner[n](E("width"===n?i:i-a*e-o*e)))},zoomIn:function(){var t=I.current,e=t.pos,n=t.openEffect,i="elastic"===n,a=S.extend({opacity:1},e);delete a.position,i?(e=this.getOrigPosition(),t.openOpacity&&(e.opacity=.1)):"fade"===n&&(e.opacity=.1),I.wrap.css(e).animate(a,{duration:"none"===n?0:t.openSpeed,easing:t.openEasing,step:i?this.step:null,complete:I._afterZoomIn})},zoomOut:function(){var t=I.current,e=t.closeEffect,n="elastic"===e,i={opacity:.1};n&&(i=this.getOrigPosition(),t.closeOpacity&&(i.opacity=.1)),I.wrap.animate(i,{duration:"none"===e?0:t.closeSpeed,easing:t.closeEasing,step:n?this.step:null,complete:I._afterZoomOut})},changeIn:function(){var t,e=I.current,n=e.nextEffect,i=e.pos,a={opacity:1},o=I.direction;i.opacity=.1,"elastic"===n&&(t="down"===o||"up"===o?"top":"left","down"===o||"right"===o?(i[t]=A(E(i[t])-200),a[t]="+=200px"):(i[t]=A(E(i[t])+200),a[t]="-=200px")),"none"===n?I._afterZoomIn():I.wrap.css(i).animate(a,{duration:e.nextSpeed,easing:e.nextEasing,complete:I._afterZoomIn})},changeOut:function(){var t=I.previous,e=t.prevEffect,n={opacity:.1},i=I.direction;"elastic"===e&&(n["down"===i||"up"===i?"top":"left"]=("up"===i||"left"===i?"-":"+")+"=200px"),t.wrap.animate(n,{duration:"none"===e?0:t.prevSpeed,easing:t.prevEasing,complete:function(){S(this).trigger("onReset").remove()}})}},I.helpers.overlay={defaults:{closeClick:!0,speedOut:200,showEarly:!0,css:{},locked:!l,fixed:!0},overlay:null,fixed:!1,el:S("html"),create:function(t){t=S.extend({},this.defaults,t),this.overlay&&this.close(),this.overlay=S('<div class="fancybox-overlay"></div>').appendTo((I.coming||t).parent),this.fixed=!1,t.fixed&&I.defaults.fixed&&(this.overlay.addClass("fancybox-overlay-fixed"),this.fixed=!0)},open:function(t){var e=this;t=S.extend({},this.defaults,t),this.overlay?this.overlay.unbind(".overlay").width("auto").height("auto"):this.create(t),this.fixed||(o.bind("resize.overlay",S.proxy(this.update,this)),this.update()),t.closeClick&&this.overlay.bind("click.overlay",function(t){if(S(t.target).hasClass("fancybox-overlay"))return(I.isActive?I:e).close(),!1}),this.overlay.css(t.css).show()},close:function(){var t,e;o.unbind("resize.overlay"),this.el.hasClass("fancybox-lock")&&(S(".fancybox-margin").removeClass("fancybox-margin"),t=o.scrollTop(),e=o.scrollLeft(),this.el.removeClass("fancybox-lock"),o.scrollTop(t).scrollLeft(e)),S(".fancybox-overlay").remove().hide(),S.extend(this,{overlay:null,fixed:!1})},update:function(){var t,e="100%";this.overlay.width(e).height("100%"),r?(t=Math.max(n.documentElement.offsetWidth,n.body.offsetWidth),c.width()>t&&(e=c.width())):c.width()>o.width()&&(e=c.width()),this.overlay.width(e).height(c.height())},onReady:function(t,e){var n=this.overlay;S(".fancybox-overlay").stop(!0,!0),n||this.create(t),t.locked&&this.fixed&&e.fixed&&(n||(this.margin=c.height()>o.height()&&S("html").css("margin-right").replace("px","")),e.locked=this.overlay.append(e.wrap),e.fixed=!1),!0===t.showEarly&&this.beforeShow.apply(this,arguments)},beforeShow:function(t,e){var n;e.locked&&(!1!==this.margin&&(S("*").filter(function(){return"fixed"===S(this).css("position")&&!S(this).hasClass("fancybox-overlay")&&!S(this).hasClass("fancybox-wrap")}).addClass("fancybox-margin"),this.el.addClass("fancybox-margin")),n=o.scrollTop(),e=o.scrollLeft(),this.el.addClass("fancybox-lock"),o.scrollTop(n).scrollLeft(e)),this.open(t)},onUpdate:function(){this.fixed||this.update()},afterClose:function(t){this.overlay&&!I.coming&&this.overlay.fadeOut(t.speedOut,S.proxy(this.close,this))}},I.helpers.title={defaults:{type:"float",position:"bottom"},beforeShow:function(t){var e=I.current,n=e.title,i=t.type;if(S.isFunction(n)&&(n=n.call(e.element,e)),p(n)&&""!==S.trim(n)){switch(e=S('<div class="fancybox-title fancybox-title-'+i+'-wrap">'+n+"</div>"),i){case"inside":i=I.skin;break;case"outside":i=I.wrap;break;case"over":i=I.inner;break;default:i=I.skin,e.appendTo("body"),r&&e.width(e.width()),e.wrapInner('<span class="child"></span>'),I.current.margin[2]+=Math.abs(E(e.css("margin-bottom")))}e["top"===t.position?"prependTo":"appendTo"](i)}}},S.fn.fancybox=function(o){function t(t){var e,n,i=S(this).blur(),a=l;t.ctrlKey||t.altKey||t.shiftKey||t.metaKey||i.is(".fancybox-wrap")||(e=o.groupAttr||"data-fancybox-group",(n=i.attr(e))||(e="rel",n=i.get(0)[e]),n&&""!==n&&"nofollow"!==n&&(a=(i=(i=s.length?S(s):r).filter("["+e+'="'+n+'"]')).index(this)),o.index=a,!1!==I.open(i,o)&&t.preventDefault())}var r=S(this),s=this.selector||"",l=(o=o||{}).index||0;return s&&!1!==o.live?c.undelegate(s,"click.fb-start").delegate(s+":not('.fancybox-item, .fancybox-nav')","click.fb-start",t):r.unbind("click.fb-start").bind("click.fb-start",t),this.filter("[data-fancybox-start=1]").trigger("click"),this},c.ready(function(){var t,e,n;S.scrollbarWidth===d&&(S.scrollbarWidth=function(){var t=S('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body"),e=(e=t.children()).innerWidth()-e.height(99).innerWidth();return t.remove(),e}),S.support.fixedPosition===d&&(t=S.support,n=20===(e=S('<div style="position:fixed;top:20px;"></div>').appendTo("body"))[0].offsetTop||15===e[0].offsetTop,e.remove(),t.fixedPosition=n),S.extend(I.defaults,{scrollbarWidth:S.scrollbarWidth(),fixed:S.support.fixedPosition,parent:S("body")}),t=S(i).width(),a.addClass("fancybox-lock-test"),e=S(i).width(),a.removeClass("fancybox-lock-test"),S("<style type='text/css'>.fancybox-margin{margin-right:"+(e-t)+"px;}</style>").appendTo("head")})}(window,document,jQuery),function(n){"function"==typeof define&&define.amd?define(["jquery"],n):"object"==typeof module&&module.exports?module.exports=function(t,e){return void 0===e&&(e="undefined"!=typeof window?require("jquery"):require("jquery")(t)),n(e),e}:n(jQuery)}(function(c){function a(t,e){this.settings=e,this.checkSettings(),this.imgAnalyzerTimeout=null,this.entries=null,this.buildingRow={entriesBuff:[],width:0,height:0,aspectRatio:0},this.lastFetchedEntry=null,this.lastAnalyzedIndex=-1,this.yield={every:2,flushed:0},this.border=0<=e.border?e.border:e.margins,this.maxRowHeight=this.retrieveMaxRowHeight(),this.suffixRanges=this.retrieveSuffixRanges(),this.offY=this.border,this.rows=0,this.spinner={phase:0,timeSlot:150,$el:c('<div class="jg-spinner"><span></span><span></span><span></span></div>'),intervalId:null},this.scrollBarOn=!1,this.checkWidthIntervalId=null,this.galleryWidth=t.width(),this.$gallery=t}a.prototype.getSuffix=function(t,e){for(var n=e<t?t:e,i=0;i<this.suffixRanges.length;i++)if(n<=this.suffixRanges[i])return this.settings.sizeRangeSuffixes[this.suffixRanges[i]];return this.settings.sizeRangeSuffixes[this.suffixRanges[i-1]]},a.prototype.removeSuffix=function(t,e){return t.substring(0,t.length-e.length)},a.prototype.endsWith=function(t,e){return-1!==t.indexOf(e,t.length-e.length)},a.prototype.getUsedSuffix=function(t){for(var e in this.settings.sizeRangeSuffixes)if(this.settings.sizeRangeSuffixes.hasOwnProperty(e)){if(0===this.settings.sizeRangeSuffixes[e].length)continue;if(this.endsWith(t,this.settings.sizeRangeSuffixes[e]))return this.settings.sizeRangeSuffixes[e]}return""},a.prototype.newSrc=function(t,e,n,i){var a;return this.settings.thumbnailPath?a=this.settings.thumbnailPath(t,e,n,i):(i=null!==(i=t.match(this.settings.extension))?i[0]:"",a=t.replace(this.settings.extension,""),a=this.removeSuffix(a,this.getUsedSuffix(a)),a+=this.getSuffix(e,n)+i),a},a.prototype.showImg=function(t,e){this.settings.cssAnimation?(t.addClass("jg-entry-visible"),e&&e()):(t.stop().fadeTo(this.settings.imagesAnimationDuration,1,e),t.find(this.settings.imgSelector).stop().fadeTo(this.settings.imagesAnimationDuration,1,e))},a.prototype.extractImgSrcFromImage=function(t){var e=t.data("safe-src"),n="data-safe-src";return void 0===e&&(e=t.attr("src"),n="src"),t.data("jg.originalSrc",e),t.data("jg.src",e),t.data("jg.originalSrcLoc",n),e},a.prototype.imgFromEntry=function(t){t=t.find(this.settings.imgSelector);return 0===t.length?null:t},a.prototype.captionFromEntry=function(t){t=t.find("> .jg-caption");return 0===t.length?null:t},a.prototype.displayEntry=function(t,e,n,i,a,o){t.width(i),t.height(o),t.css("top",n),t.css("left",e);var r,s,l=this.imgFromEntry(t);null!==l?(l.css("width",i),l.css("height",a),l.css("margin-left",-i/2),l.css("margin-top",-a/2),(r=l.data("jg.src"))&&(r=this.newSrc(r,i,a,l[0]),l.one("error",function(){this.resetImgSrc(l)}),s=function(){l.attr("src",r)},"skipped"===t.data("jg.loaded")&&r?this.onImageEvent(r,function(){this.showImg(t,s),t.data("jg.loaded",!0)}.bind(this)):this.showImg(t,s))):this.showImg(t),this.displayEntryCaption(t)},a.prototype.displayEntryCaption=function(t){var e,n=this.imgFromEntry(t);null!==n&&this.settings.captions?(null===(e=this.captionFromEntry(t))&&(n=n.attr("alt"),this.isValidCaption(n)||(n=t.attr("title")),this.isValidCaption(n)&&(e=c('<div class="jg-caption">'+n+"</div>"),t.append(e),t.data("jg.createdCaption",!0))),null!==e&&(this.settings.cssAnimation||e.stop().fadeTo(0,this.settings.captionSettings.nonVisibleOpacity),this.addCaptionEventsHandlers(t))):this.removeCaptionEventsHandlers(t)},a.prototype.isValidCaption=function(t){return void 0!==t&&0<t.length},a.prototype.onEntryMouseEnterForCaption=function(t){t=this.captionFromEntry(c(t.currentTarget));this.settings.cssAnimation?t.addClass("jg-caption-visible").removeClass("jg-caption-hidden"):t.stop().fadeTo(this.settings.captionSettings.animationDuration,this.settings.captionSettings.visibleOpacity)},a.prototype.onEntryMouseLeaveForCaption=function(t){t=this.captionFromEntry(c(t.currentTarget));this.settings.cssAnimation?t.removeClass("jg-caption-visible").removeClass("jg-caption-hidden"):t.stop().fadeTo(this.settings.captionSettings.animationDuration,this.settings.captionSettings.nonVisibleOpacity)},a.prototype.addCaptionEventsHandlers=function(t){var e;void 0===(e=t.data("jg.captionMouseEvents"))&&(e={mouseenter:c.proxy(this.onEntryMouseEnterForCaption,this),mouseleave:c.proxy(this.onEntryMouseLeaveForCaption,this)},t.on("mouseenter",void 0,void 0,e.mouseenter),t.on("mouseleave",void 0,void 0,e.mouseleave),t.data("jg.captionMouseEvents",e))},a.prototype.removeCaptionEventsHandlers=function(t){var e=t.data("jg.captionMouseEvents");void 0!==e&&(t.off("mouseenter",void 0,e.mouseenter),t.off("mouseleave",void 0,e.mouseleave),t.removeData("jg.captionMouseEvents"))},a.prototype.clearBuildingRow=function(){this.buildingRow.entriesBuff=[],this.buildingRow.aspectRatio=0,this.buildingRow.width=0},a.prototype.prepareBuildingRow=function(t,e){var n,i,a,o,r=!0,s=0,l=this.galleryWidth-2*this.border-(this.buildingRow.entriesBuff.length-1)*this.settings.margins,c=l/this.buildingRow.aspectRatio,d=this.settings.rowHeight,h=this.buildingRow.width/l>this.settings.justifyThreshold;if(e||t&&"hide"===this.settings.lastRow&&!h){for(n=0;n<this.buildingRow.entriesBuff.length;n++)i=this.buildingRow.entriesBuff[n],this.settings.cssAnimation?i.removeClass("jg-entry-visible"):(i.stop().fadeTo(0,.1),i.find("> img, > a > img").fadeTo(0,0));return-1}for(t&&!h&&"justify"!==this.settings.lastRow&&"hide"!==this.settings.lastRow&&(r=!1,0<this.rows&&(r=(d=(this.offY-this.border-this.settings.margins*this.rows)/this.rows)*this.buildingRow.aspectRatio/l>this.settings.justifyThreshold)),n=0;n<this.buildingRow.entriesBuff.length;n++)o=(i=this.buildingRow.entriesBuff[n]).data("jg.width")/i.data("jg.height"),o=r?(a=n===this.buildingRow.entriesBuff.length-1?l:c*o,c):(a=d*o,d),l-=Math.round(a),i.data("jg.jwidth",Math.round(a)),i.data("jg.jheight",Math.ceil(o)),(0===n||o<s)&&(s=o);return this.buildingRow.height=s,r},a.prototype.flushRow=function(t,e){var n,i=this.settings,a=this.border,o=this.prepareBuildingRow(t,e);if(e||t&&"hide"===i.lastRow&&-1===o)this.clearBuildingRow();else{if(this.maxRowHeight&&this.maxRowHeight<this.buildingRow.height&&(this.buildingRow.height=this.maxRowHeight),t&&("center"===i.lastRow||"right"===i.lastRow)){for(var r=this.galleryWidth-2*this.border-(this.buildingRow.entriesBuff.length-1)*i.margins,s=0;s<this.buildingRow.entriesBuff.length;s++)r-=(n=this.buildingRow.entriesBuff[s]).data("jg.jwidth");"center"===i.lastRow?a+=Math.round(r/2):"right"===i.lastRow&&(a+=r)}var l=this.buildingRow.entriesBuff.length-1;for(s=0;s<=l;s++)n=this.buildingRow.entriesBuff[this.settings.rtl?l-s:s],this.displayEntry(n,a,this.offY,n.data("jg.jwidth"),n.data("jg.jheight"),this.buildingRow.height),a+=n.data("jg.jwidth")+i.margins;this.galleryHeightToSet=this.offY+this.buildingRow.height+this.border,this.setGalleryTempHeight(this.galleryHeightToSet+this.getSpinnerHeight()),(!t||this.buildingRow.height<=i.rowHeight&&o)&&(this.offY+=this.buildingRow.height+i.margins,this.rows+=1,this.clearBuildingRow(),this.settings.triggerEvent.call(this,"jg.rowflush"))}};var e=0;a.prototype.rememberGalleryHeight=function(){e=this.$gallery.height(),this.$gallery.height(e)},a.prototype.setGalleryTempHeight=function(t){e=Math.max(t,e),this.$gallery.height(e)},a.prototype.setGalleryFinalHeight=function(t){e=t,this.$gallery.height(t)},a.prototype.checkWidth=function(){this.checkWidthIntervalId=setInterval(c.proxy(function(){var t;this.$gallery.is(":visible")&&(t=parseFloat(this.$gallery.width()),Math.abs(t-this.galleryWidth)>this.settings.refreshSensitivity&&(this.galleryWidth=t,this.rewind(),this.rememberGalleryHeight(),this.startImgAnalyzer(!0)))},this),this.settings.refreshTime)},a.prototype.isSpinnerActive=function(){return null!==this.spinner.intervalId},a.prototype.getSpinnerHeight=function(){return this.spinner.$el.innerHeight()},a.prototype.stopLoadingSpinnerAnimation=function(){clearInterval(this.spinner.intervalId),this.spinner.intervalId=null,this.setGalleryTempHeight(this.$gallery.height()-this.getSpinnerHeight()),this.spinner.$el.detach()},a.prototype.startLoadingSpinnerAnimation=function(){var t=this.spinner,e=t.$el.find("span");clearInterval(t.intervalId),this.$gallery.append(t.$el),this.setGalleryTempHeight(this.offY+this.buildingRow.height+this.getSpinnerHeight()),t.intervalId=setInterval(function(){t.phase<e.length?e.eq(t.phase).fadeTo(t.timeSlot,1):e.eq(t.phase-e.length).fadeTo(t.timeSlot,0),t.phase=(t.phase+1)%(2*e.length)},t.timeSlot)},a.prototype.rewind=function(){this.lastFetchedEntry=null,this.lastAnalyzedIndex=-1,this.offY=this.border,this.rows=0,this.clearBuildingRow()},a.prototype.getSelectorWithoutSpinner=function(){return this.settings.selector+", div:not(.jg-spinner)"},a.prototype.getAllEntries=function(){var t=this.getSelectorWithoutSpinner();return this.$gallery.children(t).toArray()},a.prototype.updateEntries=function(t){var e;return 0<(e=t&&null!=this.lastFetchedEntry?(e=this.getSelectorWithoutSpinner(),c(this.lastFetchedEntry).nextAll(e).toArray()):(this.entries=[],this.getAllEntries())).length&&(c.isFunction(this.settings.sort)?e=this.sortArray(e):this.settings.randomize&&(e=this.shuffleArray(e)),this.lastFetchedEntry=e[e.length-1],this.settings.filter?e=this.filterArray(e):this.resetFilters(e)),this.entries=this.entries.concat(e),!0},a.prototype.insertToGallery=function(t){var e=this;c.each(t,function(){c(this).appendTo(e.$gallery)})},a.prototype.shuffleArray=function(t){for(var e,n,i=t.length-1;0<i;i--)e=Math.floor(Math.random()*(i+1)),n=t[i],t[i]=t[e],t[e]=n;return this.insertToGallery(t),t},a.prototype.sortArray=function(t){return t.sort(this.settings.sort),this.insertToGallery(t),t},a.prototype.resetFilters=function(t){for(var e=0;e<t.length;e++)c(t[e]).removeClass("jg-filtered")},a.prototype.filterArray=function(t){var e=this.settings;if("string"===c.type(e.filter))return t.filter(function(t){t=c(t);return t.is(e.filter)?(t.removeClass("jg-filtered"),!0):(t.addClass("jg-filtered").removeClass("jg-visible"),!1)});if(c.isFunction(e.filter)){for(var n=t.filter(e.filter),i=0;i<t.length;i++)-1===n.indexOf(t[i])?c(t[i]).addClass("jg-filtered").removeClass("jg-visible"):c(t[i]).removeClass("jg-filtered");return n}},a.prototype.resetImgSrc=function(t){"src"===t.data("jg.originalSrcLoc")?t.attr("src",t.data("jg.originalSrc")):t.attr("src","")},a.prototype.destroy=function(){clearInterval(this.checkWidthIntervalId),this.stopImgAnalyzerStarter(),c.each(this.getAllEntries(),c.proxy(function(t,e){var n=c(e);n.css("width",""),n.css("height",""),n.css("top",""),n.css("left",""),n.data("jg.loaded",void 0),n.removeClass("jg-entry jg-filtered jg-entry-visible");e=this.imgFromEntry(n);e&&(e.css("width",""),e.css("height",""),e.css("margin-left",""),e.css("margin-top",""),this.resetImgSrc(e),e.data("jg.originalSrc",void 0),e.data("jg.originalSrcLoc",void 0),e.data("jg.src",void 0)),this.removeCaptionEventsHandlers(n);e=this.captionFromEntry(n);n.data("jg.createdCaption")?(n.data("jg.createdCaption",void 0),null!==e&&e.remove()):null!==e&&e.fadeTo(0,1)},this)),this.$gallery.css("height",""),this.$gallery.removeClass("justified-gallery"),this.$gallery.data("jg.controller",void 0),this.settings.triggerEvent.call(this,"jg.destroy")},a.prototype.analyzeImages=function(t){for(var e=this.lastAnalyzedIndex+1;e<this.entries.length;e++){var n=c(this.entries[e]);if(!0===n.data("jg.loaded")||"skipped"===n.data("jg.loaded")){var i=this.galleryWidth-2*this.border-(this.buildingRow.entriesBuff.length-1)*this.settings.margins,a=n.data("jg.width")/n.data("jg.height");if(this.buildingRow.entriesBuff.push(n),this.buildingRow.aspectRatio+=a,this.buildingRow.width+=a*this.settings.rowHeight,this.lastAnalyzedIndex=e,i/(this.buildingRow.aspectRatio+a)<this.settings.rowHeight&&(this.flushRow(!1,0<this.settings.maxRowsCount&&this.rows===this.settings.maxRowsCount),++this.yield.flushed>=this.yield.every))return void this.startImgAnalyzer(t)}else if("error"!==n.data("jg.loaded"))return}0<this.buildingRow.entriesBuff.length&&this.flushRow(!0,0<this.settings.maxRowsCount&&this.rows===this.settings.maxRowsCount),this.isSpinnerActive()&&this.stopLoadingSpinnerAnimation(),this.stopImgAnalyzerStarter(),this.setGalleryFinalHeight(this.galleryHeightToSet),this.settings.triggerEvent.call(this,t?"jg.resize":"jg.complete")},a.prototype.stopImgAnalyzerStarter=function(){this.yield.flushed=0,null!==this.imgAnalyzerTimeout&&(clearTimeout(this.imgAnalyzerTimeout),this.imgAnalyzerTimeout=null)},a.prototype.startImgAnalyzer=function(t){var e=this;this.stopImgAnalyzerStarter(),this.imgAnalyzerTimeout=setTimeout(function(){e.analyzeImages(t)},.001)},a.prototype.onImageEvent=function(t,e,n){var i,a;(e||n)&&(i=new Image,a=c(i),e&&a.one("load",function(){a.off("load error"),e(i)}),n&&a.one("error",function(){a.off("load error"),n(i)}),i.src=t)},a.prototype.init=function(){var r=!1,s=!1,l=this;c.each(this.entries,function(t,e){var n=c(e),i=l.imgFromEntry(n);if(n.addClass("jg-entry"),!0!==n.data("jg.loaded")&&"skipped"!==n.data("jg.loaded"))if(null!==l.settings.rel&&n.attr("rel",l.settings.rel),null!==l.settings.target&&n.attr("target",l.settings.target),null!==i){var a=l.extractImgSrcFromImage(i);if(!1===l.settings.waitThumbnailsLoad||!a){var o=parseFloat(i.attr("width")),e=parseFloat(i.attr("height"));if("svg"===i.prop("tagName")&&(o=parseFloat(i[0].getBBox().width),e=parseFloat(i[0].getBBox().height)),!isNaN(o)&&!isNaN(e))return n.data("jg.width",o),n.data("jg.height",e),n.data("jg.loaded","skipped"),s=!0,l.startImgAnalyzer(!1),!0}n.data("jg.loaded",!1),r=!0,l.isSpinnerActive()||l.startLoadingSpinnerAnimation(),l.onImageEvent(a,function(t){n.data("jg.width",t.width),n.data("jg.height",t.height),n.data("jg.loaded",!0),l.startImgAnalyzer(!1)},function(){n.data("jg.loaded","error"),l.startImgAnalyzer(!1)})}else n.data("jg.loaded",!0),n.data("jg.width",n.width()|parseFloat(n.css("width"))|1),n.data("jg.height",n.height()|parseFloat(n.css("height"))|1)}),r||s||this.startImgAnalyzer(!1),this.checkWidth()},a.prototype.checkOrConvertNumber=function(t,e){if("string"===c.type(t[e])&&(t[e]=parseFloat(t[e])),"number"!==c.type(t[e]))throw e+" must be a number";if(isNaN(t[e]))throw"invalid number for "+e},a.prototype.checkSizeRangesSuffixes=function(){if("object"!==c.type(this.settings.sizeRangeSuffixes))throw"sizeRangeSuffixes must be defined and must be an object";var t,e=[];for(t in this.settings.sizeRangeSuffixes)this.settings.sizeRangeSuffixes.hasOwnProperty(t)&&e.push(t);for(var n={0:""},i=0;i<e.length;i++)if("string"===c.type(e[i]))try{n[parseInt(e[i].replace(/^[a-z]+/,""),10)]=this.settings.sizeRangeSuffixes[e[i]]}catch(e){throw"sizeRangeSuffixes keys must contains correct numbers ("+e+")"}else n[e[i]]=this.settings.sizeRangeSuffixes[e[i]];this.settings.sizeRangeSuffixes=n},a.prototype.retrieveMaxRowHeight=function(){var t=null,e=this.settings.rowHeight;if("string"===c.type(this.settings.maxRowHeight))t=this.settings.maxRowHeight.match(/^[0-9]+%$/)?e*parseFloat(this.settings.maxRowHeight.match(/^([0-9]+)%$/)[1])/100:parseFloat(this.settings.maxRowHeight);else{if("number"!==c.type(this.settings.maxRowHeight)){if(!1===this.settings.maxRowHeight||null==this.settings.maxRowHeight)return null;throw"maxRowHeight must be a number or a percentage"}t=this.settings.maxRowHeight}if(isNaN(t))throw"invalid number for maxRowHeight";return t=t<e?e:t},a.prototype.checkSettings=function(){this.checkSizeRangesSuffixes(),this.checkOrConvertNumber(this.settings,"rowHeight"),this.checkOrConvertNumber(this.settings,"margins"),this.checkOrConvertNumber(this.settings,"border"),this.checkOrConvertNumber(this.settings,"maxRowsCount");var t=["justify","nojustify","left","center","right","hide"];if(-1===t.indexOf(this.settings.lastRow))throw"lastRow must be one of: "+t.join(", ");if(this.checkOrConvertNumber(this.settings,"justifyThreshold"),this.settings.justifyThreshold<0||1<this.settings.justifyThreshold)throw"justifyThreshold must be in the interval [0,1]";if("boolean"!==c.type(this.settings.cssAnimation))throw"cssAnimation must be a boolean";if("boolean"!==c.type(this.settings.captions))throw"captions must be a boolean";if(this.checkOrConvertNumber(this.settings.captionSettings,"animationDuration"),this.checkOrConvertNumber(this.settings.captionSettings,"visibleOpacity"),this.settings.captionSettings.visibleOpacity<0||1<this.settings.captionSettings.visibleOpacity)throw"captionSettings.visibleOpacity must be in the interval [0, 1]";if(this.checkOrConvertNumber(this.settings.captionSettings,"nonVisibleOpacity"),this.settings.captionSettings.nonVisibleOpacity<0||1<this.settings.captionSettings.nonVisibleOpacity)throw"captionSettings.nonVisibleOpacity must be in the interval [0, 1]";if(this.checkOrConvertNumber(this.settings,"imagesAnimationDuration"),this.checkOrConvertNumber(this.settings,"refreshTime"),this.checkOrConvertNumber(this.settings,"refreshSensitivity"),"boolean"!==c.type(this.settings.randomize))throw"randomize must be a boolean";if("string"!==c.type(this.settings.selector))throw"selector must be a string";if(!1!==this.settings.sort&&!c.isFunction(this.settings.sort))throw"sort must be false or a comparison function";if(!1!==this.settings.filter&&!c.isFunction(this.settings.filter)&&"string"!==c.type(this.settings.filter))throw"filter must be false, a string or a filter function"},a.prototype.retrieveSuffixRanges=function(){var t,e=[];for(t in this.settings.sizeRangeSuffixes)this.settings.sizeRangeSuffixes.hasOwnProperty(t)&&e.push(parseInt(t,10));return e.sort(function(t,e){return e<t?1:t<e?-1:0}),e},a.prototype.updateSettings=function(t){this.settings=c.extend({},this.settings,t),this.checkSettings(),this.border=0<=this.settings.border?this.settings.border:this.settings.margins,this.maxRowHeight=this.retrieveMaxRowHeight(),this.suffixRanges=this.retrieveSuffixRanges()},a.prototype.defaults={sizeRangeSuffixes:{},thumbnailPath:void 0,rowHeight:120,maxRowHeight:!1,maxRowsCount:0,margins:1,border:-1,lastRow:"nojustify",justifyThreshold:.9,waitThumbnailsLoad:!0,captions:!0,cssAnimation:!0,imagesAnimationDuration:500,captionSettings:{animationDuration:500,visibleOpacity:.7,nonVisibleOpacity:0},rel:null,target:null,extension:/\.[^.\\/]+$/,refreshTime:200,refreshSensitivity:0,randomize:!1,rtl:!1,sort:!1,filter:!1,selector:"a",imgSelector:"> img, > a > img, > svg, > a > svg",triggerEvent:function(t){this.$gallery.trigger(t)}},c.fn.justifiedGallery=function(i){return this.each(function(t,e){var n=c(e);n.addClass("justified-gallery");e=n.data("jg.controller");if(void 0===e){if(null!=i&&"object"!==c.type(i)){if("destroy"===i)return;throw"The argument must be an object"}e=new a(n,c.extend({},a.prototype.defaults,i)),n.data("jg.controller",e)}else if("norewind"!==i){if("destroy"===i)return void e.destroy();e.updateSettings(i),e.rewind()}e.updateEntries("norewind"===i)&&e.init()})}});